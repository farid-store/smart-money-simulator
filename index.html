<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MM Terminal // PRO-X</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #0b0e11;
            --bg-panel: #151921;
            --border-color: #2b313a;
            --text-main: #9ca3af;
            --text-light: #e5e7eb;
            --accent-green: #00f0b5;
            --accent-red: #ff3b3b;
            --accent-blue: #3b82f6;
        }
        body { background-color: var(--bg-main); color: var(--text-main); font-family: 'Inter', sans-serif; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

        /* Utilities */
        .panel { background-color: var(--bg-panel); border: 1px solid var(--border-color); }
        .text-up { color: var(--accent-green); }
        .text-down { color: var(--accent-red); }
        .bg-up-dim { background-color: rgba(0, 240, 181, 0.05); }
        .bg-down-dim { background-color: rgba(255, 59, 59, 0.05); }
        
        /* Input Reset */
        input, select { 
            background: #000; 
            border: 1px solid #333; 
            color: white; 
            font-family: 'JetBrains Mono', monospace;
            outline: none;
            transition: border-color 0.2s;
        }
        input:focus, select:focus { border-color: var(--accent-blue); }

        /* Animations */
        @keyframes flashUp { 0% { background-color: rgba(0, 240, 181, 0.4); } 100% { background-color: transparent; } }
        @keyframes flashDown { 0% { background-color: rgba(255, 59, 59, 0.4); } 100% { background-color: transparent; } }
        .flash-green { animation: flashUp 0.3s ease-out; }
        .flash-red { animation: flashDown 0.3s ease-out; }

        /* Depth Bars */
        .depth-bar {
            position: absolute;
            top: 0; bottom: 0;
            opacity: 0.15;
            z-index: 0;
            transition: width 0.2s;
        }
        .depth-row { position: relative; z-index: 1; }
    </style>
</head>
<body class="h-screen w-screen flex flex-col text-xs">

    <header class="h-10 border-b border-[#2b313a] bg-[#11141a] flex items-center justify-between px-4 select-none">
        <div class="flex items-center space-x-6">
            <div class="flex items-center space-x-2">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span class="font-bold tracking-wider text-white">MM TERMINAL <span class="text-[9px] text-gray-500 px-1 border border-gray-700 rounded">v3.0</span></span>
            </div>
            <div class="h-4 w-[1px] bg-gray-700"></div>
            <div class="flex items-center space-x-4">
                <div>
                    <span class="text-white font-bold text-sm">$BBCA</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-[9px] uppercase tracking-wide">Last Price</span>
                    <span id="header-price" class="mono font-bold text-white leading-none">9,850</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-[9px] uppercase tracking-wide">Change</span>
                    <span class="mono font-bold text-up leading-none">+0.00%</span>
                </div>
            </div>
        </div>

        <div class="flex items-center space-x-6 mono text-[10px]">
            <div class="flex items-center space-x-2 text-gray-400">
                <span>LATENCY:</span>
                <span class="text-green-400">14ms</span>
            </div>
            <div class="flex items-center space-x-2 text-gray-400">
                <span>CONNECTION:</span>
                <span class="text-green-400 font-bold">DMA DIRECT</span>
            </div>
        </div>
    </header>

    <div class="flex-1 grid grid-cols-[1fr_320px] overflow-hidden">
        
        <div class="flex flex-col border-r border-[#2b313a] relative">
            <div class="flex-1 relative bg-[#0b0e11]">
                <div class="absolute top-4 left-4 z-10 flex space-x-4 pointer-events-none">
                    <div class="bg-black/40 backdrop-blur px-2 py-1 rounded border border-gray-800 text-[10px] text-gray-400">
                        VOL: <span id="chart-vol" class="text-white mono">0</span>
                    </div>
                    <div class="bg-black/40 backdrop-blur px-2 py-1 rounded border border-gray-800 text-[10px] text-gray-400">
                        MA(20): <span class="text-yellow-400 mono">Wait...</span>
                    </div>
                </div>
                <canvas id="mainChart" class="w-full h-full block cursor-crosshair"></canvas>
            </div>

            <div class="h-40 border-t border-[#2b313a] bg-[#11141a] p-4 grid grid-cols-4 gap-4">
                <div class="panel p-3 rounded flex flex-col justify-between">
                    <span class="text-[10px] uppercase text-gray-500 font-semibold tracking-wider">Net Position</span>
                    <div class="text-2xl font-bold text-white mono" id="my-pos">0 <span class="text-xs text-gray-500">LOT</span></div>
                    <div class="w-full bg-gray-800 h-1 mt-2 rounded-full overflow-hidden">
                        <div class="bg-blue-500 h-full w-0" id="pos-bar"></div>
                    </div>
                </div>
                
                <div class="panel p-3 rounded flex flex-col justify-between">
                    <span class="text-[10px] uppercase text-gray-500 font-semibold tracking-wider">Avg Price</span>
                    <div class="text-2xl font-bold text-blue-400 mono" id="avg-price">0</div>
                    <span class="text-[10px] text-gray-600">Break Even Point</span>
                </div>

                <div class="panel p-3 rounded flex flex-col justify-between relative overflow-hidden">
                    <span class="text-[10px] uppercase text-gray-500 font-semibold tracking-wider">Unrealized P/L</span>
                    <div class="text-2xl font-bold mono" id="floating-pl">IDR 0</div>
                    <span class="text-[10px] text-gray-600">Mark to Market</span>
                </div>

                <div class="panel p-3 rounded flex flex-col justify-between">
                    <span class="text-[10px] uppercase text-gray-500 font-semibold tracking-wider">Realized P/L</span>
                    <div class="text-2xl font-bold text-gray-300 mono" id="realized-pl">IDR 0</div>
                    <span class="text-[10px] text-gray-600">Closed Trades</span>
                </div>
            </div>
        </div>

        <div class="flex flex-col bg-[#11141a]">
            
            <div class="h-8 border-b border-[#2b313a] flex items-center justify-between px-3 bg-[#151921]">
                <span class="font-bold text-gray-400 text-[10px] tracking-widest">ORDER BOOK (L2)</span>
                <span class="text-[9px] mono text-gray-600">SPREAD: <span id="spread-val" class="text-gray-300">0</span></span>
            </div>

            <div class="flex-1 overflow-y-auto bg-[#0b0e11] relative">
                <div class="grid grid-cols-3 sticky top-0 bg-[#0b0e11] z-20 text-[9px] text-gray-600 font-bold border-b border-gray-800 py-1 px-1">
                    <span class="pl-1">BID VOL</span>
                    <span class="text-center">PRICE</span>
                    <span class="text-right pr-1">OFFER VOL</span>
                </div>
                <div id="order-book-list" class="mono text-[11px] select-none">
                    </div>
            </div>

            <div class="bg-[#151921] border-t border-[#2b313a] p-3 shadow-[0_-5px_15px_rgba(0,0,0,0.3)] z-10">
                <div class="mb-3 flex items-center justify-between">
                    <span class="text-[10px] font-bold text-white uppercase tracking-wider flex items-center">
                        <span class="w-1.5 h-1.5 bg-blue-500 rounded-full mr-2"></span>
                        Algo Engine
                    </span>
                    <select id="market-mode" onchange="changeMode()" class="bg-black text-[10px] py-1 px-2 rounded border border-gray-700 text-yellow-500 font-bold uppercase cursor-pointer hover:border-yellow-600">
                        <option value="normal">MODE: STEADY</option>
                        <option value="hard">MODE: BATTLE (VOLATILE)</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-2 mb-3">
                    <div>
                        <label class="text-[9px] text-gray-500 block mb-1">LOT SIZE</label>
                        <input type="number" id="order-size" value="1000" class="w-full p-1.5 rounded text-right font-bold text-sm bg-[#050505] border-gray-800 focus:border-blue-500 text-white">
                    </div>
                    <div>
                        <label class="text-[9px] text-gray-500 block mb-1">INTERVAL (MS)</label>
                        <input type="number" id="algo-speed" value="100" class="w-full p-1.5 rounded text-right font-bold text-sm bg-[#050505] border-gray-800 focus:border-blue-500 text-white">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2 mb-2">
                    <button onclick="startAlgo('accum')" class="group relative overflow-hidden bg-[#0d2e23] border border-green-900 hover:border-green-500 rounded p-3 transition-all">
                        <div class="absolute inset-0 bg-green-500/10 translate-y-full group-hover:translate-y-0 transition-transform"></div>
                        <span class="block text-[10px] text-green-500 font-bold uppercase tracking-widest mb-0.5 relative z-10">Accumulate</span>
                        <span class="block text-[9px] text-gray-500 relative z-10">Sweep Offer</span>
                    </button>
                    <button onclick="startAlgo('distrib')" class="group relative overflow-hidden bg-[#2e0d0d] border border-red-900 hover:border-red-500 rounded p-3 transition-all">
                        <div class="absolute inset-0 bg-red-500/10 translate-y-full group-hover:translate-y-0 transition-transform"></div>
                        <span class="block text-[10px] text-red-500 font-bold uppercase tracking-widest mb-0.5 relative z-10">Distribute</span>
                        <span class="block text-[9px] text-gray-500 relative z-10">Hit Bid</span>
                    </button>
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <button onclick="startAlgo('wash')" class="bg-gray-800 border border-gray-700 hover:bg-gray-700 text-blue-400 py-2 rounded text-[10px] font-bold uppercase tracking-wide transition">
                        Churn / Wash
                    </button>
                    <button onclick="stopAlgos()" class="bg-gray-800 border border-gray-700 hover:bg-gray-700 text-white py-2 rounded text-[10px] font-bold uppercase tracking-wide transition flex items-center justify-center space-x-2">
                        <div class="w-2 h-2 bg-red-500 rounded-full animate-ping"></div>
                        <span>HALT ENGINE</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let currentPrice = 9850;
        let myPos = 0, myAvg = 0, myCost = 0, totalVol = 0, realizedPL = 0;
        let bookData = { asks: [], bids: [] };
        let history = [];
        let algoInterval = null;
        let marketInterval = null;
        let mode = 'normal';

        // --- CHART ENGINE (CANVAS) ---
        const canvas = document.getElementById('mainChart');
        const ctx = canvas.getContext('2d');

        function initChart() {
            let p = 9800;
            for(let i=0; i<100; i++) {
                let open = p;
                let close = p + (Math.random() - 0.5) * 20;
                history.push({ open, close, high: Math.max(open, close)+5, low: Math.min(open, close)-5 });
                p = close;
            }
            resize();
            animate();
        }

        function resize() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
        }
        window.onresize = resize;

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw Grid
            ctx.strokeStyle = '#1e222d';
            ctx.lineWidth = 1;
            ctx.beginPath();
            for(let x=0; x<canvas.width; x+=50) { ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); }
            for(let y=0; y<canvas.height; y+=50) { ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); }
            ctx.stroke();

            const padding = 60;
            const candleWidth = (canvas.width - padding) / history.length;
            const prices = history.map(h => [h.high, h.low]).flat();
            const maxP = Math.max(...prices) + 10;
            const minP = Math.min(...prices) - 10;
            const range = maxP - minP;

            const getY = (p) => canvas.height - 20 - ((p - minP) / range) * (canvas.height - 40);

            history.forEach((c, i) => {
                const x = i * candleWidth;
                const color = c.close >= c.open ? '#00f0b5' : '#ff3b3b';
                
                // Wick
                ctx.strokeStyle = color;
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(x + candleWidth/2, getY(c.high));
                ctx.lineTo(x + candleWidth/2, getY(c.low));
                ctx.stroke();

                // Body
                ctx.fillStyle = color;
                const h = Math.abs(getY(c.open) - getY(c.close));
                ctx.fillRect(x + 1, getY(Math.max(c.open, c.close)), candleWidth - 2, Math.max(h, 1));
            });
            
            // Current Price Line
            const lastY = getY(history[history.length-1].close);
            ctx.strokeStyle = '#333';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, lastY);
            ctx.lineTo(canvas.width, lastY);
            ctx.stroke();
            ctx.setLineDash([]);

            // Price Label on Axis
            ctx.fillStyle = history[history.length-1].close >= history[history.length-1].open ? '#00f0b5' : '#ff3b3b';
            ctx.fillRect(canvas.width - 50, lastY - 10, 50, 20);
            ctx.fillStyle = '#000';
            ctx.font = 'bold 10px JetBrains Mono';
            ctx.fillText(currentPrice.toLocaleString(), canvas.width - 45, lastY + 4);

            requestAnimationFrame(animate);
        }

        // --- MARKET LOGIC ---
        function initMarket() {
            bookData.asks = [];
            bookData.bids = [];
            for(let i=0; i<15; i++) {
                bookData.asks.push({ price: currentPrice + ((i+1)*25), vol: randVol(), freq: randFreq() });
                bookData.bids.push({ price: currentPrice - (i*25), vol: randVol(), freq: randFreq() });
            }
            runMarketEngine();
        }

        const randVol = () => Math.floor(Math.random() * 8000) + 500;
        const randFreq = () => Math.floor(Math.random() * 20) + 1;

        function runMarketEngine() {
            if(marketInterval) clearInterval(marketInterval);
            const speed = mode === 'hard' ? 100 : 800;

            marketInterval = setInterval(() => {
                // Random Retail Trades
                const side = Math.random() > 0.5 ? 'BUY' : 'SELL';
                const noiseSize = mode === 'hard' ? Math.random() * 5000 : Math.random() * 500;
                executeTrade(side, Math.floor(noiseSize), false);
                
                // Refresh Order Book
                if(Math.random() > 0.3) {
                    bookData.asks.forEach(a => a.vol += Math.floor((Math.random()-0.4)*300));
                    bookData.bids.forEach(b => b.vol += Math.floor((Math.random()-0.4)*300));
                    // Prevent negative vol
                    bookData.asks.forEach(a => a.vol = Math.max(100, a.vol));
                    bookData.bids.forEach(b => b.vol = Math.max(100, b.vol));
                }
                renderBook();
            }, speed);
        }

        function executeTrade(side, amount, isSmartMoney) {
            if(amount <= 0) return;
            totalVol += amount;

            if(side === 'BUY') {
                let target = bookData.asks[0];
                if(amount >= target.vol) {
                    currentPrice = target.price;
                    if(isSmartMoney) updatePortfolio('BUY', currentPrice, target.vol);
                    bookData.asks.shift();
                    bookData.asks.push({ price: bookData.asks[bookData.asks.length-1].price + 25, vol: randVol(), freq: randFreq() });
                    
                    // Spread logic adjustment
                    if(bookData.bids[0].price < currentPrice - 25) {
                         bookData.bids.unshift({ price: currentPrice - 25, vol: randVol()/2, freq: 1 });
                         bookData.bids.pop();
                    }
                } else {
                    target.vol -= amount;
                    currentPrice = target.price;
                    if(isSmartMoney) updatePortfolio('BUY', currentPrice, amount);
                }
            } else {
                let target = bookData.bids[0];
                if(amount >= target.vol) {
                    currentPrice = target.price;
                    if(isSmartMoney) updatePortfolio('SELL', currentPrice, target.vol);
                    bookData.bids.shift();
                    bookData.bids.push({ price: bookData.bids[bookData.bids.length-1].price - 25, vol: randVol(), freq: randFreq() });
                    
                    if(bookData.asks[0].price > currentPrice + 25) {
                        bookData.asks.unshift({ price: currentPrice + 25, vol: randVol()/2, freq: 1 });
                        bookData.asks.pop();
                    }
                } else {
                    target.vol -= amount;
                    currentPrice = target.price;
                    if(isSmartMoney) updatePortfolio('SELL', currentPrice, amount);
                }
            }

            // Sync with Chart
            let last = history[history.length-1];
            last.close = currentPrice;
            last.high = Math.max(last.high, currentPrice);
            last.low = Math.min(last.low, currentPrice);
            
            updateUI();
        }

        // --- UI & UTILS ---
        function renderBook() {
            const list = document.getElementById('order-book-list');
            let html = '';
            
            // Find max vol for bar width calculation
            const maxVol = Math.max(
                ...bookData.asks.map(a => a.vol),
                ...bookData.bids.map(b => b.vol)
            );

            // RENDER ASKS (Top - Reverse Order)
            [...bookData.asks].reverse().forEach(item => {
                const barWidth = (item.vol / maxVol) * 100;
                html += `
                <div class="grid grid-cols-3 py-[2px] hover:bg-[#1a1e26] relative cursor-pointer group">
                    <div class="depth-bar bg-red-500 right-0" style="width: ${barWidth}%"></div>
                    
                    <span class="z-10 text-gray-500 pl-2 opacity-0 group-hover:opacity-100 transition-opacity text-[9px] absolute left-0">#${item.freq}</span>
                    
                    <span class="z-10"></span> <span class="z-10 text-center text-[#ff3b3b] font-bold">${item.price.toLocaleString()}</span>
                    <span class="z-10 text-right text-gray-300 pr-2">${item.vol.toLocaleString()}</span>
                </div>`;
            });

            // CURRENT PRICE DIVIDER
            html += `
            <div class="py-1 bg-[#1e222d] border-y border-gray-700 text-center flex justify-center items-center space-x-2 my-0.5">
                <span class="text-[10px] text-gray-500">Last:</span>
                <span class="text-white font-bold text-sm">${currentPrice.toLocaleString()}</span>
            </div>
            `;

            // RENDER BIDS (Bottom)
            bookData.bids.forEach(item => {
                const barWidth = (item.vol / maxVol) * 100;
                html += `
                <div class="grid grid-cols-3 py-[2px] hover:bg-[#1a1e26] relative cursor-pointer group">
                    <div class="depth-bar bg-green-500 left-0" style="width: ${barWidth}%"></div>
                    
                    <span class="z-10 text-gray-300 pl-2 font-bold">${item.vol.toLocaleString()}</span>
                    <span class="z-10 text-center text-[#00f0b5] font-bold">${item.price.toLocaleString()}</span>
                    
                    <span class="z-10 text-gray-500 pr-2 opacity-0 group-hover:opacity-100 transition-opacity text-[9px] absolute right-0 text-right">#${item.freq}</span>
                </div>`;
            });

            list.innerHTML = html;
            
            // Calculate Spread
            const spread = bookData.asks[0].price - bookData.bids[0].price;
            document.getElementById('spread-val').innerText = spread.toLocaleString();
        }

        function updatePortfolio(side, price, lot) {
            if(side === 'BUY') {
                myCost += (price * lot * 100);
                myPos += lot;
                myAvg = myCost / (myPos * 100);
            } else if(myPos > 0) {
                let sellLot = Math.min(lot, myPos);
                
                // Realized PL Calculation
                let pnl = (price - myAvg) * sellLot * 100;
                realizedPL += pnl;

                myPos -= sellLot;
                if(myPos === 0) { myCost = 0; myAvg = 0; }
                else myCost = myAvg * myPos * 100;
            }
        }

        function updateUI() {
            // Header
            document.getElementById('header-price').innerText = currentPrice.toLocaleString();
            document.getElementById('chart-vol').innerText = totalVol.toLocaleString();
            
            // Portfolio
            document.getElementById('my-pos').innerHTML = `${myPos.toLocaleString()} <span class="text-xs text-gray-500">LOT</span>`;
            document.getElementById('avg-price').innerText = Math.round(myAvg).toLocaleString();
            document.getElementById('realized-pl').innerText = `IDR ${Math.round(realizedPL).toLocaleString()}`;
            
            const rPlEl = document.getElementById('realized-pl');
            rPlEl.className = `text-2xl font-bold mono ${realizedPL >= 0 ? 'text-up' : 'text-down'}`;

            // Floating PL
            let pl = (currentPrice - myAvg) * myPos * 100;
            if (myPos === 0) pl = 0;
            const plEl = document.getElementById('floating-pl');
            plEl.innerText = `IDR ${Math.round(pl).toLocaleString()}`;
            plEl.className = `text-2xl font-bold mono ${pl > 0 ? 'text-up' : pl < 0 ? 'text-down' : 'text-gray-500'}`;
        }

        // --- COMMANDS ---
        function startAlgo(m) {
            stopAlgos();
            const s = parseInt(document.getElementById('algo-speed').value);
            const sz = parseInt(document.getElementById('order-size').value);
            algoInterval = setInterval(() => {
                if(m === 'accum') executeTrade('BUY', sz, true);
                if(m === 'distrib') executeTrade('SELL', sz, true);
                if(m === 'wash') {
                    executeTrade('BUY', sz, true);
                    setTimeout(() => executeTrade('SELL', sz, true), s/2);
                }
            }, s);
        }

        function stopAlgos() { clearInterval(algoInterval); }
        
        function changeMode() {
            mode = document.getElementById('market-mode').value;
            runMarketEngine();
        }

        // Chart Feeder
        setInterval(() => {
            history.shift();
            history.push({ open: currentPrice, close: currentPrice, high: currentPrice, low: currentPrice });
        }, 2000); // Faster chart updates for pro feel

        // INITIALIZE
        initChart();
        initMarket();
        updateUI();

    </script>
</body>
</html>
