<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Market Maker Mind Simulator</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{background:#050709;color:#d1d4dc;font-family:Inter,system-ui}
.mono{font-family:monospace}
</style>
</head>
<body class="h-screen flex flex-col text-[12px]">

<!-- HEADER -->
<div class="flex justify-between items-center p-4 bg-[#0c0e14] border-b border-gray-800">
  <div>
    <div class="text-gray-400 text-[10px]">PRICE</div>
    <div id="price" class="text-2xl mono font-bold text-green-400">9,850</div>
  </div>
  <div>
    <div class="text-gray-400 text-[10px]">MM PHASE</div>
    <div id="phase" class="mono font-bold text-yellow-400">ACCUMULATION</div>
  </div>
  <div>
    <div class="text-gray-400 text-[10px]">MM INVENTORY</div>
    <div id="inv" class="mono font-bold text-blue-400">0</div>
  </div>
  <div>
    <div class="text-gray-400 text-[10px]">RETAIL EMOTION</div>
    <div id="emotion" class="mono font-bold">Neutral</div>
  </div>
</div>

<!-- MAIN -->
<div class="flex flex-1 overflow-hidden">

<!-- CHART -->
<div class="flex-1 relative">
<canvas id="chart"></canvas>
</div>

<!-- SIDE -->
<div class="w-[360px] bg-[#0c0e14] border-l border-gray-800 p-4 space-y-4">

<div>
<div class="text-gray-500 text-[10px] mb-1">MARKET MAKER BRAIN</div>
<div class="bg-[#131722] p-3 rounded space-y-1 mono">
<div>Avg Price: <span id="mmAvg">0</span></div>
<div>P/L: <span id="mmPL">0</span></div>
<div>Target Liquidity: 50,000</div>
</div>
</div>

<div>
<div class="text-gray-500 text-[10px] mb-1">RETAIL STATE</div>
<div class="bg-[#131722] p-3 rounded space-y-1 mono">
<div>Fear: <span id="fear">50</span></div>
<div>Greed: <span id="greed">50</span></div>
<div>SL Cluster: 9,700</div>
</div>
</div>

<div>
<button onclick="toggle()" class="w-full bg-blue-600 py-3 rounded font-bold">
START / STOP SIMULATION
</button>
</div>

</div>
</div>

<script>
/* ===== CORE STATE ===== */
let price = 9850;
let running = false;

const MM = {
 inventory:0,
 avg:0,
 pnl:0,
 phase:'ACCUMULATION',
 target:50000
};

const RETAIL = {
 fear:50,
 greed:50,
 sl:9700
};

const history=[];
const canvas=document.getElementById('chart');
const ctx=canvas.getContext('2d');

/* ===== ENGINE ===== */
function updatePhase(){
 if(MM.inventory < MM.target*0.3) MM.phase='ACCUMULATION';
 else if(MM.inventory < MM.target*0.6) MM.phase='MARKUP';
 else if(RETAIL.greed>70) MM.phase='DISTRIBUTION';
 else if(RETAIL.fear>70) MM.phase='STOP_HUNT';
}

/* ===== MARKET LOGIC ===== */
function marketStep(){
 updatePhase();

 let buy=0,sell=0;

 if(MM.phase==='ACCUMULATION'){
   sell=Math.random()*2000;
   buy=Math.random()*500;
 }
 if(MM.phase==='MARKUP'){
   buy=Math.random()*3000;
 }
 if(MM.phase==='DISTRIBUTION'){
   sell=Math.random()*3000;
 }
 if(MM.phase==='STOP_HUNT'){
   sell=Math.random()*5000;
 }

 // Retail reaction
 if(price>history.at(-1)){
   RETAIL.greed+=2;
   buy+=Math.random()*2000;
 }
 if(price<RETAIL.sl){
   RETAIL.fear+=10;
   sell+=Math.random()*4000;
 }

 // Execute
 const net=buy-sell;
 price+=Math.sign(net)*Math.min(Math.abs(net)/1500,25);

 // MM inventory
 MM.inventory+=buy-sell;
 if(MM.inventory!==0){
   MM.avg=((MM.avg*(MM.inventory-(buy-sell)))+(price*(buy-sell)))/MM.inventory;
 }
 MM.pnl=(price-MM.avg)*MM.inventory;

 history.push(price);
 if(history.length>120)history.shift();

 draw();
 updateUI();
}

/* ===== DRAW ===== */
function draw(){
 canvas.width=canvas.clientWidth;
 canvas.height=canvas.clientHeight;
 ctx.clearRect(0,0,canvas.width,canvas.height);

 const max=Math.max(...history)+20;
 const min=Math.min(...history)-20;

 history.forEach((p,i)=>{
   const x=i*(canvas.width/history.length);
   const y=canvas.height-((p-min)/(max-min))*canvas.height;
   ctx.fillStyle='#22c55e';
   ctx.fillRect(x,y,2,2);
 });
}

/* ===== UI ===== */
function updateUI(){
 document.getElementById('price').innerText=price.toLocaleString();
 document.getElementById('phase').innerText=MM.phase;
 document.getElementById('inv').innerText=Math.round(MM.inventory);
 document.getElementById('mmAvg').innerText=Math.round(MM.avg);
 document.getElementById('mmPL').innerText=Math.round(MM.pnl);

 document.getElementById('fear').innerText=Math.round(RETAIL.fear);
 document.getElementById('greed').innerText=Math.round(RETAIL.greed);

 document.getElementById('emotion').innerText=
  RETAIL.greed>70?'FOMO':
  RETAIL.fear>70?'PANIC':'NEUTRAL';
}

/* ===== LOOP ===== */
let loop;
function toggle(){
 running=!running;
 if(running){
   loop=setInterval(marketStep,200);
 }else clearInterval(loop);
}

history.push(price);
draw();
updateUI();
</script>

</body>
</html>
