<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Institutional MM Terminal - Professional Grade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #050505; --panel: #0f0f0f; --border: #1f1f1f; }
        body { background-color: var(--bg); color: #ccc; font-family: 'Inter', sans-serif; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        canvas { image-rendering: -webkit-optimize-contrast; }
        .glitch-red { color: #ff3e3e; text-shadow: 2px 0 #550000; }
        .glitch-green { color: #3eff3e; text-shadow: 2px 0 #005500; }
    </style>
</head>
<body class="flex h-screen w-screen text-[11px] select-none bg-black">

    <aside class="w-[70px] bg-[#0c0c0c] border-r border-[#222] flex flex-col items-center py-6 z-50 gap-6">
        <div class="font-black text-blue-600 text-lg tracking-tighter">SMM</div>
        
        <div class="flex flex-col gap-4 w-full px-2">
            <button onmousedown="Engine.manualPush('BUY')" class="group p-3 rounded-xl bg-green-950/20 border border-green-900/50 hover:bg-green-600 hover:text-black transition-all">
                <span class="block font-bold text-lg">↑</span>
                <span class="text-[7px] font-bold opacity-50 group-hover:opacity-100">PUMP</span>
            </button>
            <button onmousedown="Engine.manualPush('SELL')" class="group p-3 rounded-xl bg-red-950/20 border border-red-900/50 hover:bg-red-600 hover:text-black transition-all">
                <span class="block font-bold text-lg">↓</span>
                <span class="text-[7px] font-bold opacity-50 group-hover:opacity-100">DUMP</span>
            </button>
            
            <div class="h-[1px] bg-[#222] w-full my-2"></div>

            <button onclick="Engine.triggerHunt()" class="p-2 rounded bg-yellow-600/10 border border-yellow-600/50 text-yellow-600 hover:bg-yellow-600 hover:text-black font-bold text-[8px]">
                LIQ HUNT
            </button>
        </div>

        <div class="mt-auto pb-4 flex flex-col items-center gap-4">
            <div id="connection-status" class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
            <div class="vertical-text text-[8px] text-gray-600 font-mono tracking-widest" style="writing-mode: vertical-rl;">ALGO_v4.0_STABLE</div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col">
        <header class="h-12 bg-[#0c0c0c] border-b border-[#1a1a1a] flex items-center px-6 justify-between">
            <div class="flex items-center gap-8">
                <div>
                    <span class="text-xs font-bold text-white tracking-widest">XBT/USD</span>
                    <span class="ml-2 text-[9px] text-blue-500 font-mono">PRO_FEED</span>
                </div>
                <div class="flex gap-4 border-l border-[#222] pl-6">
                    <div class="flex flex-col">
                        <span class="text-[8px] text-gray-500 uppercase">Retail Sentiment</span>
                        <div class="flex items-center gap-2">
                            <div class="w-24 h-1.5 bg-[#1a1a1a] rounded-full overflow-hidden">
                                <div id="sentiment-bar" class="h-full bg-blue-500 transition-all duration-500" style="width: 50%"></div>
                            </div>
                            <span id="sentiment-text" class="text-[10px] mono text-blue-400">NEUTRAL</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex items-center gap-8 font-mono">
                <div class="text-right">
                    <div class="text-[8px] text-gray-600">MM INVENTORY</div>
                    <div id="mm-inventory" class="text-xs font-bold text-gray-300">0.00</div>
                </div>
                <div class="text-right border-l border-[#222] pl-8">
                    <div class="text-[8px] text-gray-600">UNREALIZED PnL</div>
                    <div id="pnl-display" class="text-sm font-black text-white">$0.00</div>
                </div>
            </div>
        </header>

        <div class="flex-1 flex overflow-hidden">
            <div class="flex-1 relative bg-[#050505]">
                <canvas id="mainChart" class="w-full h-full"></canvas>
                
                <div class="absolute top-6 left-6 pointer-events-none">
                    <div id="price-container">
                        <h1 id="big-price" class="text-4xl font-black text-white mono leading-none">0.00</h1>
                        <div id="price-change" class="text-[10px] mt-2 mono text-green-500">+0.00%</div>
                    </div>
                </div>

                <div id="alert-toast" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 opacity-0 pointer-events-none transition-all duration-300">
                    <div class="bg-blue-600 text-white px-6 py-3 font-black text-lg tracking-tighter skew-x-[-10deg] italic">ALGO INTERVENTION</div>
                </div>
            </div>

            <aside class="w-[280px] bg-[#0c0c0c] border-l border-[#1a1a1a] flex flex-col">
                <div class="p-3 border-b border-[#1a1a1a] bg-[#0e0e0e] flex justify-between items-center">
                    <span class="text-[9px] font-bold text-gray-500 tracking-widest">ORDER BOOK DEPTH</span>
                    <span class="text-[8px] text-green-500 bg-green-500/10 px-1 rounded">LIVE</span>
                </div>
                
                <div id="dom-ladder" class="flex-1 overflow-hidden font-mono text-[10px] bg-[#050505]"></div>

                <div class="p-4 bg-[#0e0e0e] border-t border-[#1a1a1a]">
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="Trader.open('BUY')" class="py-4 bg-green-600 hover:bg-green-500 text-black font-black rounded active:scale-95 transition-all">BUY / LONG</button>
                        <button onclick="Trader.open('SELL')" class="py-4 bg-red-600 hover:bg-red-500 text-black font-black rounded active:scale-95 transition-all">SELL / SHORT</button>
                    </div>
                    <button onclick="Trader.closeAll()" class="w-full mt-3 py-2 border border-[#222] text-gray-500 hover:text-white hover:border-gray-500 text-[9px] font-bold rounded transition-all">EXIT ALL POSITIONS</button>
                </div>
            </aside>
        </div>
    </main>

    <script>
        const CONFIG = {
            tickRate: 50,
            candleTime: 40, 
            spread: 2.5,
            initialPrice: 50000.00,
            retailResponsiveness: 0.15 // Seberapa cepat retail FOMO
        };

        const Engine = {
            price: CONFIG.initialPrice,
            velocity: 0,
            acceleration: 0,
            inventory: 0, // MM Inventory
            sentiment: 50, // 0: Panic, 100: FOMO
            candles: [],
            currentCandle: null,
            ticks: 0,
            
            init() {
                for(let i=0; i<100; i++) this.generateHistory();
                this.startNewCandle();
                this.loop();
            },

            generateHistory() {
                const lastC = this.candles.length ? this.candles[this.candles.length-1].c : this.price;
                const o = lastC, c = o + (Math.random()-0.5)*100;
                this.candles.push({o, h: Math.max(o,c)+20, l: Math.min(o,c)-20, c});
                this.price = c;
            },

            startNewCandle() {
                this.ticks = 0;
                this.currentCandle = { o: this.price, h: this.price, l: this.price, c: this.price };
            },

            // LOGIKA DINAMIS: MARKET RHYTHM
            processMarketPhysics() {
                // 1. RETAIL BEHAVIOR (FOMO/PANIC)
                // Jika harga naik cepat, sentiment naik (FOMO)
                const priceMove = this.velocity;
                this.sentiment += priceMove * CONFIG.retailResponsiveness;
                this.sentiment = Math.max(5, Math.min(95, this.sentiment));

                // Retail murni mengikuti trend (Herd Mentality)
                let retailForce = (this.sentiment - 50) * 0.05;

                // 2. INVENTORY GRAVITY
                // MM ingin inventory kembali ke 0. Jika MM terlalu "Long", MM akan "Dump" perlahan.
                let inventoryRebalance = -this.inventory * 0.01;

                // 3. NOISE
                let marketNoise = (Math.random() - 0.5) * 2;

                this.acceleration = retailForce + inventoryRebalance + marketNoise;
                this.velocity = (this.velocity + this.acceleration) * 0.95;
                this.price += this.velocity;

                // Update Candle
                const c = this.currentCandle;
                c.c = this.price;
                if(c.c > c.h) c.h = c.c;
                if(c.c < c.l) c.l = c.c;
                
                this.ticks++;
                if(this.ticks >= CONFIG.candleTime) {
                    this.candles.push({...this.currentCandle});
                    if(this.candles.length > 100) this.candles.shift();
                    this.startNewCandle();
                }
            },

            // ACTIONS
            manualPush(side) {
                const power = side === 'BUY' ? 15 : -15;
                this.velocity += power;
                this.inventory += (side === 'BUY' ? 5 : -5); // MM taking position
                UI.showAlert(side === 'BUY' ? "INSTITUTIONAL BUY ORDER" : "INSTITUTIONAL SELL ORDER");
            },

            triggerHunt() {
                const side = Math.random() > 0.5 ? 1 : -1;
                this.velocity = side * 40;
                UI.showAlert("⚠️ LIQUIDITY SWEEP");
            },

            loop() {
                this.processMarketPhysics();
                Chart.draw();
                DOM.update();
                UI.update();
                Trader.update();
                setTimeout(() => this.loop(), CONFIG.tickRate);
            }
        };

        const Chart = {
            canvas: document.getElementById('mainChart'),
            ctx: document.getElementById('mainChart').getContext('2d'),
            
            draw() {
                const { canvas, ctx } = this;
                const w = canvas.width = canvas.parentElement.clientWidth;
                const h = canvas.height = canvas.parentElement.clientHeight;
                
                ctx.fillStyle = '#050505';
                ctx.fillRect(0, 0, w, h);

                // Grid
                ctx.strokeStyle = '#111';
                ctx.lineWidth = 1;
                for(let x=0; x<w; x+=50) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke(); }
                for(let y=0; y<h; y+=50) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke(); }

                const visible = [...Engine.candles, Engine.currentCandle].slice(-60);
                const min = Math.min(...visible.map(c => c.l)) * 0.999;
                const max = Math.max(...visible.map(c => c.h)) * 1.001;
                const range = max - min;

                const getY = (p) => h - ((p - min) / range * h);
                const candleW = w / 65;

                visible.forEach((c, i) => {
                    const x = i * (candleW + 2) + 20;
                    const isUp = c.c >= c.o;
                    const color = isUp ? '#22c55e' : '#ef4444';
                    
                    ctx.strokeStyle = color;
                    ctx.lineWidth = 1;
                    // Wick
                    ctx.beginPath();
                    ctx.moveTo(x + candleW/2, getY(c.h));
                    ctx.lineTo(x + candleW/2, getY(c.l));
                    ctx.stroke();
                    // Body
                    ctx.fillStyle = color;
                    const yOpen = getY(c.o), yClose = getY(c.c);
                    ctx.fillRect(x, Math.min(yOpen, yClose), candleW, Math.max(1, Math.abs(yOpen - yClose)));
                });

                // Price Line
                const py = getY(Engine.price);
                ctx.setLineDash([5, 5]);
                ctx.strokeStyle = '#555';
                ctx.beginPath(); ctx.moveTo(0, py); ctx.lineTo(w, py); ctx.stroke();
                ctx.setLineDash([]);
            }
        };

        const DOM = {
            update() {
                const el = document.getElementById('dom-ladder');
                let html = '';
                const p = Engine.price;
                const sentimentFactor = (Engine.sentiment / 100);

                // Asks (Red)
                for(let i=12; i>0; i--) {
                    const price = p + (i * 0.5);
                    const vol = Math.floor(Math.random() * 500 * (2 - sentimentFactor));
                    html += `<div class="flex justify-between px-4 h-4 items-center text-red-500/80">
                        <span>${price.toFixed(1)}</span>
                        <div class="h-1 bg-red-900/30" style="width: ${vol/10}%"></div>
                        <span class="font-bold">${vol}</span>
                    </div>`;
                }
                html += `<div class="bg-white/5 py-1 text-center font-bold text-white text-[9px]">SPREAD ${CONFIG.spread}</div>`;
                // Bids (Green)
                for(let i=1; i<=12; i++) {
                    const price = p - (i * 0.5);
                    const vol = Math.floor(Math.random() * 500 * sentimentFactor);
                    html += `<div class="flex justify-between px-4 h-4 items-center text-green-500/80">
                        <span>${price.toFixed(1)}</span>
                        <div class="h-1 bg-green-900/30" style="width: ${vol/10}%"></div>
                        <span class="font-bold">${vol}</span>
                    </div>`;
                }
                el.innerHTML = html;
            }
        };

        const Trader = {
            pos: [],
            open(side) {
                this.pos.push({ side, entry: Engine.price, size: 1 });
                // MM Reaction: Jika Anda BUY, MM terpaksa SELL kepada Anda (Inventory MM berkurang)
                Engine.inventory += (side === 'BUY' ? -1 : 1);
            },
            closeAll() { 
                this.pos.forEach(p => Engine.inventory += (p.side === 'BUY' ? 1 : -1));
                this.pos = []; 
            },
            update() {
                let pnl = 0;
                this.pos.forEach(p => {
                    pnl += (p.side === 'BUY' ? Engine.price - p.entry : p.entry - Engine.price);
                });
                const el = document.getElementById('pnl-display');
                el.innerText = `$${pnl.toFixed(2)}`;
                el.className = `text-sm font-black mono ${pnl >= 0 ? 'text-green-500' : 'text-red-500'}`;
            }
        };

        const UI = {
            update() {
                document.getElementById('big-price').innerText = Engine.price.toFixed(2);
                document.getElementById('mm-inventory').innerText = Engine.inventory.toFixed(2);
                
                const s = Engine.sentiment;
                const sBar = document.getElementById('sentiment-bar');
                const sText = document.getElementById('sentiment-text');
                sBar.style.width = s + '%';
                
                if(s > 70) { sText.innerText = "FOMO ALERT"; sText.className = "text-[10px] mono text-green-500 font-bold"; }
                else if(s < 30) { sText.innerText = "PANIC SELLING"; sText.className = "text-[10px] mono text-red-500 font-bold"; }
                else { sText.innerText = "STABLE"; sText.className = "text-[10px] mono text-blue-400"; }
            },
            showAlert(msg) {
                const t = document.getElementById('alert-toast');
                t.children[0].innerText = msg;
                t.style.opacity = 1;
                setTimeout(() => t.style.opacity = 0, 1500);
            }
        };

        Engine.init();
    </script>
</body>
</html>
