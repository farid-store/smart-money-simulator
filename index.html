<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stockbit MM Simulator - Pro Trader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #0d1117; color: #e6edf3; font-family: 'Inter', sans-serif; }
        .sb-border { border-color: #30363d; }
        .bg-stockbit-dark { background-color: #0d1117; }
        .bg-stockbit-card { background-color: #161b22; }
        .text-buy { color: #26a69a; }
        .text-sell { color: #ef5350; }
        .bg-buy { background-color: rgba(38, 166, 154, 0.1); }
        .bg-sell { background-color: rgba(239, 83, 80, 0.1); }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body x-data="mmSimulator()">

    <nav class="flex items-center justify-between px-6 py-3 bg-stockbit-card border-b sb-border">
        <div class="flex items-center space-x-6">
            <h1 class="text-xl font-bold text-green-500">Stockbit <span class="text-white font-light text-sm italic">MM Engine</span></h1>
            <div class="flex space-x-4 text-sm font-medium text-gray-400">
                <a href="#" class="text-white">Watchlist</a>
                <a href="#">Stream</a>
                <a href="#" class="border-b-2 border-green-500 text-green-500">MM Terminal</a>
                <a href="#">Portfolio</a>
            </div>
        </div>
        <div class="flex items-center space-x-4">
            <div class="text-right">
                <p class="text-xs text-gray-400">Buying Power</p>
                <p class="text-sm font-bold text-green-400">Rp 1.250.000.000</p>
            </div>
            <div class="w-8 h-8 bg-gray-600 rounded-full"></div>
        </div>
    </nav>

    <div class="grid grid-cols-12 gap-1 p-2 h-[calc(100vh-64px)]">
        
        <div class="col-span-8 flex flex-col space-y-2">
            <div class="bg-stockbit-card p-4 rounded-md border sb-border flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold">BBCA <span class="text-sm font-normal text-gray-400">Bank Central Asia Tbk.</span></h2>
                    <p class="text-buy font-bold text-lg">9,850 <span class="text-sm">+150 (1.55%)</span></p>
                </div>
                <div class="flex space-x-2">
                    <button class="px-4 py-2 bg-gray-700 rounded text-sm hover:bg-gray-600">Indicator</button>
                    <button class="px-4 py-2 bg-gray-700 rounded text-sm hover:bg-gray-600">1D</button>
                </div>
            </div>

            <div class="bg-stockbit-card flex-grow rounded-md border sb-border p-2" id="chartContainer"></div>
        </div>

        <div class="col-span-4 flex flex-col space-y-2">
            
            <div class="bg-stockbit-card p-4 rounded-md border-2 border-green-600 shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold flex items-center"><i data-lucide="cpu" class="w-4 h-4 mr-2 text-green-500"></i> MM ALGO CONFIG</h3>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" x-model="algoActive" class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                    </label>
                </div>
                
                <div class="grid grid-cols-2 gap-4 text-xs">
                    <div>
                        <p class="text-gray-400 mb-1">Spread (Ticks)</p>
                        <input type="number" x-model="mmSettings.spread" class="w-full bg-gray-800 border sb-border p-2 rounded">
                    </div>
                    <div>
                        <p class="text-gray-400 mb-1">Lot per Order</p>
                        <input type="number" x-model="mmSettings.lotSize" class="w-full bg-gray-800 border sb-border p-2 rounded">
                    </div>
                    <div>
                        <p class="text-gray-400 mb-1">Bias / Skew</p>
                        <select x-model="mmSettings.bias" class="w-full bg-gray-800 border sb-border p-2 rounded">
                            <option value="neutral">Neutral</option>
                            <option value="accumulation">Accumulation</option>
                            <option value="distribution">Distribution</option>
                        </select>
                    </div>
                    <div>
                        <p class="text-gray-400 mb-1">Frequency (ms)</p>
                        <input type="number" x-model="mmSettings.freq" class="w-full bg-gray-800 border sb-border p-2 rounded">
                    </div>
                </div>

                <div class="mt-4 p-2 bg-black rounded text-[10px] font-mono text-green-400 h-20 overflow-y-auto" id="algoLog">
                    > System ready... <br>
                    > Waiting for activation...
                </div>
            </div>

            <div class="bg-stockbit-card flex-grow rounded-md border sb-border overflow-hidden flex flex-col">
                <div class="grid grid-cols-2 text-center text-xs font-bold border-b sb-border">
                    <div class="py-2 bg-buy text-buy">BID</div>
                    <div class="py-2 bg-sell text-sell">OFFER</div>
                </div>
                <div class="flex-grow overflow-y-auto text-xs">
                    <div class="grid grid-cols-2">
                        <div class="border-r sb-border">
                            <template x-for="(bid, index) in bids" :key="index">
                                <div class="flex justify-between px-2 py-1 hover:bg-gray-800 cursor-pointer relative">
                                    <div class="absolute inset-y-0 right-0 bg-buy opacity-20" :style="`width: ${bid.vol / 50}%`"></div>
                                    <span class="z-10 text-gray-400" x-text="bid.queue"></span>
                                    <span class="z-10 font-bold text-buy" x-text="formatNumber(bid.price)"></span>
                                    <span class="z-10" x-text="bid.vol"></span>
                                </div>
                            </template>
                        </div>
                        <div>
                            <template x-for="(ask, index) in asks" :key="index">
                                <div class="flex justify-between px-2 py-1 hover:bg-gray-800 cursor-pointer relative">
                                    <div class="absolute inset-y-0 left-0 bg-sell opacity-20" :style="`width: ${ask.vol / 50}%`"></div>
                                    <span class="z-10" x-text="ask.vol"></span>
                                    <span class="z-10 font-bold text-sell" x-text="formatNumber(ask.price)"></span>
                                    <span class="z-10 text-gray-400" x-text="ask.queue"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-stockbit-card p-4 rounded-md border sb-border">
                <div class="flex justify-between items-center text-sm">
                    <span class="text-gray-400">Position (Lot)</span>
                    <span :class="inventory >= 0 ? 'text-buy' : 'text-sell'" class="font-bold" x-text="inventory"></span>
                </div>
                <div class="flex justify-between items-center text-sm mt-2">
                    <span class="text-gray-400">Unrealized P/L</span>
                    <span :class="pnl >= 0 ? 'text-buy' : 'text-sell'" class="font-bold" x-text="'Rp ' + formatNumber(pnl)"></span>
                </div>
            </div>

        </div>
    </div>

    <script>
        function mmSimulator() {
            return {
                algoActive: false,
                inventory: 0,
                pnl: 0,
                mmSettings: {
                    spread: 2,
                    lotSize: 100,
                    bias: 'neutral',
                    freq: 1000
                },
                bids: [],
                asks: [],
                lastPrice: 9850,
                
                init() {
                    lucide.createIcons();
                    this.initChart();
                    this.generateInitialOrderBook();
                    
                    // Main Simulation Loop
                    setInterval(() => {
                        this.simulateMarketTakers();
                        if (this.algoActive) {
                            this.runAlgo();
                        }
                    }, 1000);
                },

                initChart() {
                    const chart = LightweightCharts.createChart(document.getElementById('chartContainer'), {
                        layout: { backgroundColor: '#161b22', textColor: '#d1d4dc' },
                        grid: { vertLines: { color: '#30363d' }, horzLines: { color: '#30363d' } },
                        timeScale: { timeVisible: true, secondsVisible: false }
                    });
                    const candleSeries = chart.addCandlestickSeries({
                        upColor: '#26a69a', downColor: '#ef5350', borderVisible: false,
                        wickUpColor: '#26a69a', wickDownColor: '#ef5350'
                    });

                    // Generate dummy candles
                    let data = [];
                    let time = new Date();
                    time.setHours(9, 0, 0, 0);
                    for(let i=0; i<100; i++) {
                        data.push({
                            time: time.getTime() / 1000 + (i * 60),
                            open: 9700 + Math.random() * 100,
                            high: 9850 + Math.random() * 50,
                            low: 9650 - Math.random() * 50,
                            close: 9800 + Math.random() * 50
                        });
                    }
                    candleSeries.setData(data);
                },

                generateInitialOrderBook() {
                    for(let i=0; i<10; i++) {
                        this.bids.push({ price: 9850 - (i * 25), vol: Math.floor(Math.random() * 5000), queue: Math.floor(Math.random() * 100) });
                        this.asks.push({ price: 9875 + (i * 25), vol: Math.floor(Math.random() * 5000), queue: Math.floor(Math.random() * 100) });
                    }
                },

                formatNumber(n) {
                    return new Intl.NumberFormat('id-ID').format(n);
                },

                log(msg) {
                    const el = document.getElementById('algoLog');
                    el.innerHTML += `> ${msg} <br>`;
                    el.scrollTop = el.scrollHeight;
                },

                // THE LOGIC
                runAlgo() {
                    const midPrice = (this.bids[0].price + this.asks[0].price) / 2;
                    const spreadTicks = parseInt(this.mmSettings.spread);
                    
                    // MM places orders
                    this.log(`Placing Quote: ${midPrice - 25} | ${midPrice + 25}`);
                    
                    // Simple bias logic
                    if(this.mmSettings.bias === 'accumulation') {
                        this.bids[0].vol += parseInt(this.mmSettings.lotSize);
                    } else if(this.mmSettings.bias === 'distribution') {
                        this.asks[0].vol += parseInt(this.mmSettings.lotSize);
                    }
                },

                simulateMarketTakers() {
                    // Random retail buying/selling
                    const side = Math.random() > 0.5 ? 'BUY' : 'SELL';
                    const amount = Math.floor(Math.random() * 50);

                    if(side === 'BUY') {
                        this.asks[0].vol -= amount;
                        if(this.algoActive) {
                            this.inventory -= amount;
                            this.pnl += amount * 25; // Simple spread capture simulation
                        }
                    } else {
                        this.bids[0].vol -= amount;
                        if(this.algoActive) {
                            this.inventory += amount;
                            this.pnl += amount * 25;
                        }
                    }

                    // Replenish liquidity if empty
                    if(this.bids[0].vol <= 0) this.bids[0].vol = 1000;
                    if(this.asks[0].vol <= 0) this.asks[0].vol = 1000;
                }
            }
        }
    </script>
</body>
</html>
