<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartAlgo Pro V8 - Ultimate Bandar Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* THEME VARIABLES */
        :root { 
            --bg-main: #0b0e11; 
            --bg-panel: #151924; 
            --border: #2a2e39; 
            --text-muted: #848e9c; 
            --up: #00b894; 
            --down: #ff7675; 
            --accent: #0984e3;
        }
        
        /* BASE */
        body { background-color: var(--bg-main); color: #EAECEF; font-family: 'Inter', sans-serif; overflow: hidden; user-select: none; }
        .mono { font-family: 'Roboto Mono', monospace; }
        .bg-panel { background-color: var(--bg-panel); }
        .border-dark { border-color: var(--border); }
        
        /* COLORS */
        .text-up { color: var(--up); } .text-down { color: var(--down); }
        .bg-up { background-color: var(--up); } .bg-down { background-color: var(--down); }
        
        /* ORDER BOOK BARS */
        .bar-ask { position: absolute; top:0; left:0; height:100%; background: rgba(255, 118, 117, 0.15); z-index:0; transition: width 0.1s; }
        .bar-bid { position: absolute; top:0; right:0; height:100%; background: rgba(0, 184, 148, 0.15); z-index:0; transition: width 0.1s; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }

        /* ANIMATIONS */
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(255, 118, 117, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 118, 117, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 118, 117, 0); } }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(0, 184, 148, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 184, 148, 0); } }
        .active-algo-buy { animation: pulse-green 1.5s infinite; border: 1px solid var(--up) !important; }
        .active-algo-sell { animation: pulse-red 1.5s infinite; border: 1px solid var(--down) !important; }

        /* TOAST */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 4px; padding: 12px; position: fixed; z-index: 99; left: 50%; top: 80px; transform: translateX(-50%); font-size: 13px; opacity: 0; transition: opacity 0.3s; }
        #toast.show { visibility: visible; opacity: 1; }
    </style>
</head>
<body class="flex flex-col h-screen w-screen text-[12px]">

    <header class="h-14 flex items-center justify-between px-4 bg-panel border-b border-dark shrink-0 z-20">
        <div class="flex items-center gap-6">
            <div class="font-bold text-lg text-blue-500 tracking-wider flex items-center gap-2">
                <span>SMARTALGO</span> <span class="bg-blue-600 text-white text-[9px] px-1 rounded">PRO</span>
            </div>
            <div class="h-8 w-px bg-gray-700"></div>
            <div>
                <span class="text-[9px] text-muted block font-bold">SYMBOL</span>
                <span class="font-bold text-base tracking-wide">$GOTO</span>
            </div>
            <div>
                <span class="text-[9px] text-muted block font-bold">LAST PRICE</span>
                <span class="font-bold text-xl mono" id="head-price">92</span>
            </div>
            <div class="flex flex-col">
                 <span class="text-[9px] text-muted font-bold">MARKET MODE</span>
                 <select id="battle-mode" class="bg-black border border-gray-600 text-[10px] text-white rounded p-0.5 outline-none">
                     <option value="normal">ðŸŸ¢ NORMAL</option>
                     <option value="volatile">ðŸŸ¡ VOLATILE (Hard)</option>
                     <option value="war">ðŸ”´ WAR ZONE (Aggro)</option>
                 </select>
            </div>
        </div>
        
        <div class="flex items-center gap-6">
             <div class="text-right cursor-pointer hover:opacity-80" onclick="APP.askBalance()">
                <span class="text-[9px] text-muted block font-bold">CASH AVAILABLE (Click to Set)</span>
                <div class="font-bold mono text-yellow-500 text-base" id="head-cash">IDR 0</div>
            </div>
            <div class="text-right">
                <span class="text-[9px] text-muted block font-bold">FLOATING P/L</span>
                <div class="font-bold mono text-base" id="head-pl">IDR 0</div>
            </div>
        </div>
    </header>

    <div class="flex-1 flex overflow-hidden">
        
        <div class="flex-1 flex flex-col min-w-0 bg-[#0b0e11] border-r border-dark relative group">
            <div class="absolute top-2 left-2 z-10 flex gap-2">
                <button onclick="CHART.setTF(1)" class="bg-gray-800 text-xs px-2 py-1 rounded border border-gray-600 hover:bg-gray-700 text-white">1m</button>
                <button onclick="CHART.setTF(5)" class="bg-gray-800 text-xs px-2 py-1 rounded border border-gray-600 hover:bg-gray-700 text-white">5m</button>
            </div>
            <canvas id="mainChart" class="block w-full h-full cursor-crosshair"></canvas>
        </div>

        <div class="w-[400px] flex flex-col bg-panel shrink-0 border-l border-dark">
            
            <div class="h-[40%] flex flex-col border-b border-dark">
                <div class="px-2 py-1 bg-[#11141b] border-b border-dark flex justify-between">
                    <span class="text-[10px] font-bold text-muted uppercase">Order Book (Depth)</span>
                </div>
                <div class="grid grid-cols-3 text-[9px] text-muted font-bold px-2 py-1 bg-black/20">
                    <span>BID LOT</span><span class="text-center">PRICE</span><span class="text-right">ASK LOT</span>
                </div>
                <div id="book-container" class="flex-1 overflow-y-auto relative bg-[#0b0e11]"></div>
            </div>

            <div class="h-[20%] flex flex-col border-b border-dark">
                <div class="px-2 py-1 bg-[#11141b] border-b border-dark">
                     <span class="text-[10px] font-bold text-muted uppercase">Running Trade</span>
                </div>
                <div id="tape-container" class="flex-1 overflow-y-auto font-mono text-[10px] bg-[#0b0e11]"></div>
            </div>

            <div class="flex-1 p-3 bg-panel flex flex-col gap-2 overflow-y-auto">
                
                <div class="flex justify-between text-[10px] bg-[#0b0e11] p-2 rounded border border-dark mb-1">
                    <span class="text-muted">Avg: <span id="lbl-avg" class="text-white font-mono">0</span></span>
                    <span class="text-muted">Pos: <span id="lbl-pos" class="text-blue-400 font-mono font-bold">0</span></span>
                </div>

                <div class="flex gap-2 mb-2">
                    <div class="flex-1">
                        <label class="text-[9px] text-muted font-bold block">LOT SIZE</label>
                        <input type="number" id="input-lot" value="1000" class="w-full bg-black border border-dark text-white p-1.5 text-center font-mono font-bold rounded focus:border-blue-500 outline-none">
                    </div>
                    <div class="flex-1">
                        <label class="text-[9px] text-muted font-bold block">SPEED (ms)</label>
                        <input type="number" id="algo-speed" value="200" class="w-full bg-black border border-dark text-white p-1.5 text-center font-mono rounded outline-none">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-2 mb-2">
                    <button onclick="APP.submitOrder('BUY')" class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 rounded text-xs transition border-b-2 border-green-800">BUY (HAKA)</button>
                    <button onclick="APP.submitOrder('SELL')" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 rounded text-xs transition border-b-2 border-red-800">SELL (HAKI)</button>
                </div>

                <div class="border-t border-dark pt-2">
                    <label class="text-[9px] text-blue-400 font-bold block mb-2 text-center uppercase tracking-widest">--- Smart Money Tools ---</label>
                    
                    <div class="grid grid-cols-3 gap-2 mb-2">
                        <button id="btn-auto-buy" onclick="APP.toggleAlgo('auto-buy')" class="bg-[#1e232f] border border-dark text-gray-300 text-[10px] py-2 rounded hover:bg-gray-700">Auto Haka</button>
                        <button id="btn-wash" onclick="APP.toggleAlgo('wash')" class="bg-[#1e232f] border border-dark text-yellow-500 text-[10px] py-2 rounded hover:bg-gray-700">Wash Trade</button>
                        <button id="btn-auto-sell" onclick="APP.toggleAlgo('auto-sell')" class="bg-[#1e232f] border border-dark text-gray-300 text-[10px] py-2 rounded hover:bg-gray-700">Auto Haki</button>
                    </div>

                    <div class="grid grid-cols-2 gap-2">
                        <button id="btn-fakeout" onclick="APP.triggerManipulation('fakeout')" class="bg-[#1e232f] border border-red-900/50 text-red-400 text-[10px] py-2 rounded hover:bg-red-900/20 font-bold">Fakeout (Bull Trap)</button>
                        <button id="btn-breakout" onclick="APP.triggerManipulation('breakout')" class="bg-[#1e232f] border border-green-900/50 text-green-400 text-[10px] py-2 rounded hover:bg-green-900/20 font-bold">Force Breakout</button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="toast">Notification</div>

<script>
/**
 * SMARTALGO V8 - THE BRAIN
 */

const $ = (id) => document.getElementById(id);
const fmtMoney = (n) => parseInt(n).toLocaleString('id-ID');
const rand = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
const showToast = (msg, type='') => {
    const t = $('toast');
    t.innerText = msg;
    t.className = "show";
    t.style.backgroundColor = type === 'error' ? '#d63031' : '#0984e3';
    setTimeout(() => t.className = "", 3000);
};

// --- STATE ---
const STATE = {
    price: 92,
    cash: 100000000, // 100 Juta default
    portfolio: { pos: 0, avg: 0 },
    bids: [], 
    asks: [],
    trades: [],
    
    // Algos
    algoInterval: null,
    activeAlgo: null, // 'auto-buy', 'auto-sell', 'wash'
    
    // Chart
    candles: [],
    tf: 1, // minutes
    
    // System
    mode: 'normal'
};

// --- ENGINE ---
const APP = {
    init() {
        this.resetBook(STATE.price);
        CHART.init();
        this.renderLoop();
        
        // Market Heartbeat (Organic Movement)
        setInterval(() => this.marketTick(), 500); 
    },

    askBalance() {
        let input = prompt("Masukkan Saldo Baru (Rupiah):", STATE.cash);
        if(input && !isNaN(input)) {
            STATE.cash = parseInt(input);
            showToast("Saldo Diupdate: " + fmtMoney(STATE.cash));
        }
    },

    resetBook(p) {
        STATE.asks = []; STATE.bids = [];
        for(let i=0; i<20; i++) {
            STATE.asks.push({price: p + (i+1), vol: rand(5000, 50000)}); // High Liquidity (GOTO style)
            STATE.bids.push({price: p - i, vol: rand(5000, 50000)});
        }
    },

    // --- TRADING LOGIC ---
    submitOrder(side, qtyOverride = null, isUser = true) {
        const lot = qtyOverride || parseInt($('input-lot').value);
        if(lot <= 0) return;

        // Validasi Saldo (Hanya untuk User)
        if(isUser) {
            if(side === 'BUY') {
                const est = STATE.asks[0].price * lot * 100;
                if(STATE.cash < est) return showToast("SALDO KURANG!", "error");
            } else {
                if(STATE.portfolio.pos < lot) return showToast("BARANG KURANG!", "error");
            }
        }

        // Eksekusi
        this.matchOrder(side, lot, isUser);
    },

    matchOrder(side, vol, isUser) {
        let remaining = vol;
        let books = side === 'BUY' ? STATE.asks : STATE.bids;
        let totalCost = 0;
        let filled = 0;

        while(remaining > 0 && books.length > 0) {
            let best = books[0];
            let tradeVol = Math.min(remaining, best.vol);
            
            // Logika Harga: Harga berubah JIKA level habis
            STATE.price = best.price;
            CHART.update(best.price, tradeVol);

            best.vol -= tradeVol;
            remaining -= tradeVol;
            filled += tradeVol;
            totalCost += (best.price * tradeVol * 100);

            // Tape Record
            STATE.trades.unshift({time: new Date().toLocaleTimeString(), price: best.price, vol: tradeVol, side: side});
            if(STATE.trades.length > 50) STATE.trades.pop();

            // Level Habis?
            if(best.vol <= 0) {
                books.shift();
                // Replenish depth
                if(side==='BUY') {
                    let last = STATE.asks[STATE.asks.length-1].price;
                    STATE.asks.push({price: last+1, vol: rand(10000,50000)});
                } else {
                    let last = STATE.bids[STATE.bids.length-1].price;
                    STATE.bids.push({price: last-1, vol: rand(10000,50000)});
                }
            }
        }

        if(isUser && filled > 0) this.updatePorto(side, filled, totalCost);
    },

    updatePorto(side, vol, val) {
        const P = STATE.portfolio;
        if(side === 'BUY') {
            STATE.cash -= val;
            let oldVal = P.pos * P.avg * 100;
            P.pos += vol;
            P.avg = (oldVal + val) / (P.pos * 100);
        } else {
            STATE.cash += val;
            P.pos -= vol;
            if(P.pos === 0) P.avg = 0;
        }
    },

    // --- ALGORITHMS (BANDAR FEATURES) ---
    toggleAlgo(type) {
        // Stop current if running
        if(STATE.algoInterval) {
            clearInterval(STATE.algoInterval);
            STATE.algoInterval = null;
            this.clearAlgoStyles();
            
            // If clicking same button, just stop
            if(STATE.activeAlgo === type) {
                STATE.activeAlgo = null;
                return;
            }
        }

        STATE.activeAlgo = type;
        const speed = parseInt($('algo-speed').value);
        const lot = parseInt($('input-lot').value);
        
        // Visual Feedback
        if(type === 'auto-buy') $('btn-auto-buy').classList.add('active-algo-buy');
        if(type === 'auto-sell') $('btn-auto-sell').classList.add('active-algo-sell');
        if(type === 'wash') $('btn-wash').classList.add('border-yellow-500', 'text-yellow-400');

        STATE.algoInterval = setInterval(() => {
            if(type === 'auto-buy') this.submitOrder('BUY', lot, true);
            if(type === 'auto-sell') this.submitOrder('SELL', lot, true);
            if(type === 'wash') {
                // Wash Trade: Buy & Sell at same time without consuming User Cash (Fake Volume)
                // We simulate this by directly injecting trades and volume without updating portfolio
                const p = STATE.price;
                const v = lot;
                CHART.update(p, v*2);
                STATE.trades.unshift({time: new Date().toLocaleTimeString(), price: p, vol: v, side: 'BUY'});
                STATE.trades.unshift({time: new Date().toLocaleTimeString(), price: p, vol: v, side: 'SELL'});
                // Fake eat liquidity visuals
                STATE.asks[0].vol += v; // Add then eat to keep price stable
                this.matchOrder('BUY', v, false); // Execute buy logic but isUser=false
            }
        }, speed);
    },

    clearAlgoStyles() {
        $('btn-auto-buy').className = "bg-[#1e232f] border border-dark text-gray-300 text-[10px] py-2 rounded hover:bg-gray-700";
        $('btn-auto-sell').className = "bg-[#1e232f] border border-dark text-gray-300 text-[10px] py-2 rounded hover:bg-gray-700";
        $('btn-wash').className = "bg-[#1e232f] border border-dark text-yellow-500 text-[10px] py-2 rounded hover:bg-gray-700";
    },

    triggerManipulation(type) {
        const lot = parseInt($('input-lot').value) * 5; // Big volume
        if(type === 'fakeout') {
            // Naik 3 tick cepat, lalu guyur
            showToast("âš ï¸ FAKEOUT DETECTED!");
            let count = 0;
            let iv = setInterval(() => {
                this.submitOrder('BUY', lot, false); // Bot buy
                count++;
                if(count > 3) {
                    clearInterval(iv);
                    setTimeout(() => {
                         // DUMP
                         for(let i=0; i<6; i++) this.submitOrder('SELL', lot*2, false);
                    }, 500);
                }
            }, 100);
        }
        if(type === 'breakout') {
            // Hajar kanan non-stop 5x
            showToast("ðŸš€ BREAKOUT MOMENTUM!");
            let count = 0;
            let iv = setInterval(() => {
                this.submitOrder('BUY', lot*2, false);
                count++;
                if(count > 5) clearInterval(iv);
            }, 100);
        }
    },

    // --- MARKET HEARTBEAT (BATTLE MODES) ---
    marketTick() {
        STATE.mode = $('battle-mode').value;
        let volatility = 1;
        let bias = 0.5; // 0.5 = Neutral

        // Logic Mode
        if(STATE.mode === 'volatile') {
            volatility = 3;
            // Random aggressive jumps
        }
        if(STATE.mode === 'war') {
            // Contra User Position
            if(STATE.portfolio.pos > 5000) bias = 0.2; // Sell pressure (Bandar guyur)
            if(STATE.portfolio.pos < 0) bias = 0.8; // Buy pressure (Short squeeze)
            volatility = 2;
        }

        // Random Execution
        if(Math.random() > 0.3) return; // Not every tick triggers trade
        
        const side = Math.random() < bias ? 'BUY' : 'SELL';
        const vol = rand(10, 500) * volatility;
        this.matchOrder(side, vol, false);

        // Replenish Orderbook (Maker)
        if(Math.random() > 0.5) {
            STATE.asks[rand(0,5)].vol += rand(100, 1000);
            STATE.bids[rand(0,5)].vol += rand(100, 1000);
        }
    },

    // --- RENDER ---
    renderLoop() {
        requestAnimationFrame(() => this.renderLoop());

        // 1. Book
        const bEl = $('book-container');
        let html = '';
        // Asks (Reverse)
        STATE.asks.slice(0,10).reverse().forEach(a => {
            let w = Math.min((a.vol/100000)*100, 100);
            html += `<div class="grid grid-cols-3 px-2 py-0.5 relative cursor-pointer hover:bg-white/5" onclick="APP.submitOrder('BUY', ${a.vol})">
                <div class="bar-ask" style="width:${w}%"></div>
                <span class="text-left z-10 text-muted">-</span>
                <span class="text-center z-10 text-down font-bold">${a.price}</span>
                <span class="text-right z-10 text-muted font-mono">${a.vol.toLocaleString()}</span>
            </div>`;
        });
        html += `<div class="text-center text-[9px] py-0.5 bg-black/50 border-y border-dark text-muted">Spread: ${STATE.asks[0].price - STATE.bids[0].price}</div>`;
        // Bids
        STATE.bids.slice(0,10).forEach(b => {
            let w = Math.min((b.vol/100000)*100, 100);
            html += `<div class="grid grid-cols-3 px-2 py-0.5 relative cursor-pointer hover:bg-white/5" onclick="APP.submitOrder('SELL', ${b.vol})">
                <div class="bar-bid" style="width:${w}%"></div>
                <span class="text-left z-10 text-muted font-mono">${b.vol.toLocaleString()}</span>
                <span class="text-center z-10 text-up font-bold">${b.price}</span>
                <span class="text-right z-10 text-muted">-</span>
            </div>`;
        });
        bEl.innerHTML = html;

        // 2. Tape
        const tEl = $('tape-container');
        let tHtml = '';
        STATE.trades.forEach(t => {
            let col = t.side==='BUY'?'text-up':'text-down';
            tHtml += `<div class="grid grid-cols-3 px-2 border-b border-white/5">
                <span class="text-muted">${t.time.split(' ')[0]}</span>
                <span class="text-center ${col} font-bold">${t.price}</span>
                <span class="text-right text-gray-400">${t.vol}</span>
            </div>`;
        });
        tEl.innerHTML = tHtml;

        // 3. Headers
        $('head-price').innerText = STATE.price;
        $('head-cash').innerText = "IDR " + fmtMoney(STATE.cash);
        $('lbl-pos').innerText = fmtMoney(STATE.portfolio.pos);
        $('lbl-avg').innerText = Math.round(STATE.portfolio.avg);
        
        const pl = (STATE.price - STATE.portfolio.avg) * STATE.portfolio.pos * 100;
        const plEl = $('head-pl');
        plEl.innerText = "IDR " + fmtMoney(pl);
        plEl.className = `font-bold mono text-base ${pl>=0 ? 'text-up':'text-down'}`;
    }
};

// --- CHART ENGINE ---
const CHART = {
    canvas: $('mainChart'),
    ctx: $('mainChart').getContext('2d'),
    data: [], // {time, o, h, l, c}
    
    init() {
        this.resize();
        window.onresize = () => this.resize();
        // Fake History
        let p = 90;
        let t = Date.now() - (60*60000);
        for(let i=0; i<60; i++) {
            let c = p + rand(-2, 2);
            this.data.push({time: t + (i*60000), o:p, h:Math.max(p,c)+rand(0,2), l:Math.min(p,c)-rand(0,2), c:c});
            p=c;
        }
        this.loop();
    },
    resize() {
        this.canvas.width = this.canvas.parentElement.clientWidth;
        this.canvas.height = this.canvas.parentElement.clientHeight;
    },
    setTF(m) { STATE.tf = m; this.data=[]; this.init(); }, // Reset for simplicity
    
    update(price, vol) {
        let last = this.data[this.data.length-1];
        let now = Date.now();
        let interval = STATE.tf * 60000;
        
        if(now - last.time > interval) {
            this.data.push({time: now, o:price, h:price, l:price, c:price});
            if(this.data.length > 80) this.data.shift();
        } else {
            last.c = price;
            if(price > last.h) last.h = price;
            if(price < last.l) last.l = price;
        }
    },
    
    loop() {
        requestAnimationFrame(() => this.loop());
        const ctx = this.ctx;
        const w = this.canvas.width;
        const h = this.canvas.height;
        
        ctx.fillStyle = '#0b0e11'; ctx.fillRect(0,0,w,h);
        
        // Grid
        ctx.strokeStyle = '#1e232f'; ctx.lineWidth=1;
        ctx.beginPath(); for(let i=0; i<h; i+=40){ctx.moveTo(0,i);ctx.lineTo(w,i);} ctx.stroke();

        let vals = this.data.map(d=>[d.h, d.l]).flat();
        let min = Math.min(...vals)-2; let max = Math.max(...vals)+2;
        let range = max-min;
        const getY = p => h - ((p-min)/range)*(h-40) - 20;
        const barW = (w-20) / 60;

        this.data.forEach((d,i) => {
            let x = 10 + (i*barW);
            let col = d.c >= d.o ? '#00b894' : '#ff7675';
            ctx.fillStyle = col; ctx.strokeStyle = col;
            ctx.beginPath(); ctx.moveTo(x+barW/2, getY(d.h)); ctx.lineTo(x+barW/2, getY(d.l)); ctx.stroke();
            let bH = Math.max(1, Math.abs(getY(d.o)-getY(d.c)));
            ctx.fillRect(x+1, getY(Math.max(d.o, d.c)), barW-2, bH);
        });
        
        // Price Line
        let py = getY(STATE.price);
        ctx.strokeStyle = '#fff'; ctx.setLineDash([2,4]);
        ctx.beginPath(); ctx.moveTo(0, py); ctx.lineTo(w, py); ctx.stroke(); ctx.setLineDash([]);
    }
};

window.onload = () => APP.init();

</script>
</body>
</html>
