<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartAlgo Pro v2.1 - Battle Mode</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body { font-family:'Inter',sans-serif;background:#050709;color:#d1d4dc;overflow:hidden;}
.mono{font-family:'Roboto Mono',monospace;}
.bg-sidebar{background:#0c0e14;}
.bg-card{background:#131722;}
.border-stockbit{border-color:#1e222d;}
::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-thumb{background:#333;}
input{background:#000!important;color:#00ff00!important;border:1px solid #222!important;text-align:center;}
.zone-box{position:absolute;left:0;width:100%;pointer-events:none;opacity:.08}
</style>
</head>
<body class="flex h-screen w-screen text-[13px]">

<aside class="w-14 bg-sidebar border-r border-stockbit flex flex-col items-center py-4 space-y-8">
<div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center font-bold text-white">S</div>
</aside>

<main class="flex-1 flex flex-col">
<header class="h-14 bg-sidebar border-b border-stockbit flex items-center px-6 justify-between">

<div class="flex items-center space-x-8">
<div>
<span class="text-gray-500 text-[10px] block uppercase">Ticker</span>
<span class="font-bold text-lg text-white">$BBCA</span>
</div>

<div>
<span class="text-gray-500 text-[10px] block uppercase">Last Price</span>
<div class="text-green-500 font-bold mono text-xl" id="live-price">9,850</div>
</div>

<div>
<span class="text-gray-500 text-[10px] block uppercase">Net Position</span>
<div class="text-white font-bold mono" id="my-pos">0 LOT</div>
</div>

<div>
<span class="text-gray-500 text-[10px] block uppercase">Avg Price</span>
<div class="text-blue-400 font-bold mono" id="avg-price">0</div>
</div>

<div>
<span class="text-gray-500 text-[10px] block uppercase">Balance</span>
<div class="text-yellow-400 font-bold mono" id="balance">IDR 1,000,000,000</div>
</div>

<div>
<span class="text-gray-500 text-[10px] block uppercase">Equity</span>
<div class="text-white font-bold mono" id="equity">IDR 1,000,000,000</div>
</div>

<div>
<span class="text-gray-500 text-[10px] block uppercase">Realized P/L</span>
<div class="font-bold mono" id="realized-pl">0</div>
</div>
</div>

<div class="flex items-center space-x-4">
<select id="market-mode" onchange="changeMode()" class="bg-black text-yellow-400 font-bold px-3 py-1">
<option value="normal">NORMAL</option>
<option value="hard">HARD (Battle Zone)</option>
</select>
<div>
<span class="text-gray-500 text-[10px] block uppercase">Floating</span>
<div class="font-bold mono" id="floating-pl">0</div>
</div>
</div>
</header>

<div class="flex-1 flex overflow-hidden">

<div class="flex-1 relative bg-[#050709] overflow-hidden">
<canvas id="mainChart" class="w-full h-full"></canvas>
<div id="supplyZone" class="zone-box bg-red-500"></div>
<div id="demandZone" class="zone-box bg-green-500"></div>
</div>

<div class="w-[380px] bg-sidebar border-l border-stockbit flex flex-col">
<div class="p-3 flex-1 overflow-y-auto mono text-[11px]" id="order-book-list"></div>

<div class="p-4 bg-card border-t border-stockbit space-y-3">
<input type="number" id="order-size" value="1000" class="w-full p-2 rounded font-bold">
<input type="number" id="algo-speed" value="150" class="w-full p-2 rounded font-bold">

<div class="grid grid-cols-2 gap-2">
<button onclick="startAlgo('accum')" class="bg-green-600 py-2 rounded font-bold">Haka Accum</button>
<button onclick="startAlgo('distrib')" class="bg-red-600 py-2 rounded font-bold">Haki Distrib</button>
</div>
<button onclick="stopAlgos()" class="bg-gray-700 w-full py-2 rounded font-bold">STOP</button>
</div>
</div>
</div>
</main>

<script>
let currentPrice=9850;
let myPos=0,myAvg=0,myCost=0;
let balance=1000000000;
let realizedPL=0;
let totalVol=0;
let history=[];
let bookData={asks:[],bids:[]};
let algoInterval=null,marketInterval=null;
let mode='normal';
let supplyZone=10000;
let demandZone=9600;
let fearIndex=0;

const canvas=document.getElementById('mainChart');
const ctx=canvas.getContext('2d');

function resize(){
canvas.width=canvas.parentElement.clientWidth;
canvas.height=canvas.parentElement.clientHeight;
}
window.onresize=resize;

function initChart(){
let p=9800;
for(let i=0;i<80;i++){
let close=p+(Math.random()-0.5)*20;
history.push({open:p,close,high:close+5,low:close-5});
p=close;
}
resize();
animate();
}

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);
const pad=60;
const w=(canvas.width-pad*2)/history.length;
let prices=history.map(h=>[h.high,h.low]).flat();
let max=Math.max(...prices)+5;
let min=Math.min(...prices)-5;
let range=max-min;
const getY=p=>canvas.height-pad-((p-min)/range)*(canvas.height-pad*2);

history.forEach((c,i)=>{
const x=pad+i*w;
const color=c.close>=c.open?'#22c55e':'#ef4444';
ctx.strokeStyle=color;
ctx.beginPath();
ctx.moveTo(x+w/2,getY(c.high));
ctx.lineTo(x+w/2,getY(c.low));
ctx.stroke();
ctx.fillStyle=color;
ctx.fillRect(x+2,getY(Math.max(c.open,c.close)),w-4,Math.max(Math.abs(getY(c.open)-getY(c.close)),1));
});
drawZones(getY);
requestAnimationFrame(animate);
}

function drawZones(getY){
let sY=getY(supplyZone);
let dY=getY(demandZone);
let h=30;
document.getElementById('supplyZone').style.top=sY+'px';
document.getElementById('supplyZone').style.height=h+'px';
document.getElementById('demandZone').style.top=dY-h+'px';
document.getElementById('demandZone').style.height=h+'px';
}

function initMarket(){
for(let i=0;i<15;i++){
bookData.asks.push({price:currentPrice+(i+1)*2,vol:randVol()});
bookData.bids.push({price:currentPrice-(i*2),vol:randVol()});
}
runMarketEngine();
}

const randVol=()=>Math.floor(Math.random()*8000)+1000;

function runMarketEngine(){
if(marketInterval)clearInterval(marketInterval);
marketInterval=setInterval(()=>{
retailBehavior();
battleZone();
renderBook();
},mode==='hard'?150:600);
}

function retailBehavior(){
let move=Math.random();
let size=Math.floor(Math.random()*2000);

if(currentPrice<demandZone && move>.3){
executeTrade('SELL',size,false);
fearIndex++;
}
else if(currentPrice>supplyZone && move>.3){
executeTrade('BUY',size,false);
fearIndex++;
}
else{
executeTrade(Math.random()>.5?'BUY':'SELL',size,false);
fearIndex=Math.max(0,fearIndex-1);
}
}

function battleZone(){
if(mode!=='hard')return;

if(Math.abs(currentPrice-supplyZone)<20){
executeTrade('SELL',3000,true);
}
if(Math.abs(currentPrice-demandZone)<20){
executeTrade('BUY',3000,true);
}
}

function executeTrade(side,amount,isSmart){
if(amount<=0)return;
totalVol+=amount;

if(side==='BUY'){
let target=bookData.asks[0];
currentPrice=target.price;
if(isSmart)updatePortfolio('BUY',currentPrice,amount);
}
else{
let target=bookData.bids[0];
currentPrice=target.price;
if(isSmart)updatePortfolio('SELL',currentPrice,amount);
}

let last=history[history.length-1];
last.close=currentPrice;
last.high=Math.max(last.high,currentPrice);
last.low=Math.min(last.low,currentPrice);

updateUI();
}

function updatePortfolio(side,price,lot){
let value=price*lot*100;
if(side==='BUY'){
if(balance<value)return;
balance-=value;
myCost+=value;
myPos+=lot;
myAvg=myCost/(myPos*100);
}else{
let sellLot=Math.min(lot,myPos);
let proceeds=price*sellLot*100;
balance+=proceeds;
realizedPL+=(price-myAvg)*sellLot*100;
myPos-=sellLot;
if(myPos===0){myCost=0;myAvg=0;}
}
}

function renderBook(){
let html='';
for(let i=14;i>=0;i--){
html+=`
<div class="grid grid-cols-2 border-b border-gray-800 px-2 py-1">
<div class="text-red-400">${bookData.asks[i].price.toLocaleString()} | ${bookData.asks[i].vol.toLocaleString()}</div>
<div class="text-green-400 text-right">${bookData.bids[i].vol.toLocaleString()} | ${bookData.bids[i].price.toLocaleString()}</div>
</div>`;
}
document.getElementById('order-book-list').innerHTML=html;
}

function updateUI(){
document.getElementById('live-price').innerText=currentPrice.toLocaleString();
document.getElementById('my-pos').innerText=myPos.toLocaleString()+" LOT";
document.getElementById('avg-price').innerText=Math.round(myAvg).toLocaleString();
document.getElementById('balance').innerText="IDR "+balance.toLocaleString();
document.getElementById('realized-pl').innerText=realizedPL.toLocaleString();
let floating=(currentPrice-myAvg)*myPos*100;
if(myPos===0)floating=0;
document.getElementById('floating-pl').innerText=floating.toLocaleString();
document.getElementById('equity').innerText="IDR "+(balance+floating).toLocaleString();
}

function startAlgo(m){
stopAlgos();
const s=parseInt(document.getElementById('algo-speed').value);
const sz=parseInt(document.getElementById('order-size').value);
algoInterval=setInterval(()=>{
if(m==='accum')executeTrade('BUY',sz,true);
if(m==='distrib')executeTrade('SELL',sz,true);
},s);
}

function stopAlgos(){clearInterval(algoInterval);}
function changeMode(){mode=document.getElementById('market-mode').value;runMarketEngine();}

setInterval(()=>{
history.shift();
history.push({open:currentPrice,close:currentPrice,high:currentPrice,low:currentPrice});
},15000);

initChart();
initMarket();
updateUI();
</script>
</body>
</html>
