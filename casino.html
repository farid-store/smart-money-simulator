<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Poseidon's Treasury - Realistic Casino Shooter</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
            font-family: 'Orbitron', sans-serif;
            user-select: none;
        }

        /* UI Overlay */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
            background: radial-gradient(circle at center, transparent 0%, rgba(0,0,10,0.8) 100%);
        }

        .header {
            display: flex;
            justify-content: space-between;
            color: #00d4ff;
            text-shadow: 0 0 10px #00d4ff;
            z-index: 10;
        }

        .balance-box {
            background: rgba(0, 20, 40, 0.8);
            border: 2px solid #ffd700;
            padding: 10px 30px;
            border-radius: 50px;
            font-size: 24px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .controls {
            pointer-events: auto;
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-btn {
            background: linear-gradient(180deg, #222, #111);
            color: white;
            border: 2px solid #444;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Orbitron';
            font-weight: bold;
            transition: 0.2s;
            min-width: 150px;
            text-align: center;
        }

        .control-btn:active { transform: scale(0.95); }
        .control-btn.active { border-color: #00d4ff; box-shadow: 0 0 15px #00d4ff; }

        canvas {
            display: block;
            background: linear-gradient(to bottom, #001e36, #000411);
        }

        /* Notifikasi Menang */
        .floating-text {
            position: absolute;
            font-weight: bold;
            font-size: 20px;
            color: #ffd700;
            animation: floatUp 1s forwards;
            pointer-events: none;
            text-shadow: 0 0 5px black;
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.5); }
        }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="ui-layer">
    <div class="header">
        <div>POSEIDON'S TREASURY</div>
        <div class="balance-box">
            <span>ðŸª™</span> <span id="balanceDisplay">5000</span>
        </div>
    </div>
    
    <div class="controls">
        <div class="control-btn" id="btn-low" onclick="setPower(1)">
            <div>NORMAL</div>
            <div style="font-size: 12px; color: #888;">Biaya: 10</div>
        </div>
        <div class="control-btn" id="btn-high" onclick="setPower(2)">
            <div>HIGH POWER</div>
            <div style="font-size: 12px; color: #f00;">Biaya: 50</div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // --- KONFIGURASI LAYAR ---
    let width, height;
    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- GAME STATE ---
    let balance = 5000;
    let bulletPower = 1; // 1 = Normal, 2 = High
    let bulletCost = 10;
    
    const mouse = { x: width/2, y: height/2 };
    canvas.addEventListener('mousemove', e => {
        mouse.x = e.clientX;
        mouse.y = e.clientY;
    });

    // --- ASSETS GENERATION (PROCEDURAL) ---
    // Kita menggambar ikan menggunakan path agar tidak perlu load gambar
    
    // --- CLASSES ---

    class Fish {
        constructor() {
            this.reset();
        }

        reset() {
            this.y = Math.random() * (height - 100) + 50;
            this.direction = Math.random() > 0.5 ? 1 : -1; // 1 = Kanan, -1 = Kiri
            this.x = this.direction === 1 ? -100 : width + 100;
            
            // Atribut Acak
            const type = Math.random();
            if (type > 0.9) { // BOSS (Paus Emas)
                this.size = 50 + Math.random() * 20;
                this.speed = 0.5 + Math.random() * 0.5;
                this.color = '#ffd700'; // Emas
                this.maxHp = 20;
                this.value = 500;
                this.name = "BOSS";
            } else if (type > 0.6) { // Ikan Sedang (Merah)
                this.size = 30 + Math.random() * 10;
                this.speed = 1.5 + Math.random();
                this.color = '#ff4444'; 
                this.maxHp = 5;
                this.value = 50;
                this.name = "MED";
            } else { // Ikan Kecil (Biru/Hijau)
                this.size = 15 + Math.random() * 10;
                this.speed = 2 + Math.random() * 1.5;
                this.color = `hsl(${160 + Math.random() * 60}, 100%, 50%)`;
                this.maxHp = 1;
                this.value = 10;
                this.name = "SML";
            }
            
            this.hp = this.maxHp;
            this.angle = 0;
            this.oscillationSpeed = 0.1;
            this.oscillationAmt = 2; 
        }

        update() {
            this.x += this.speed * this.direction;
            this.y += Math.sin(this.x * 0.01) * this.oscillationAmt; // Gerakan bergelombang
            
            // Hit box update
            if ((this.direction === 1 && this.x > width + 100) || 
                (this.direction === -1 && this.x < -100)) {
                this.reset();
            }
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            // Putar badan ikan sesuai arah
            ctx.scale(this.direction, 1); 

            // Badan Ikan (Procedural)
            ctx.fillStyle = this.color;
            ctx.shadowBlur = 10;
            ctx.shadowColor = this.color;
            
            ctx.beginPath();
            // Bentuk oval badan
            ctx.ellipse(0, 0, this.size, this.size/2, 0, 0, Math.PI*2);
            ctx.fill();

            // Ekor
            ctx.beginPath();
            const tailWag = Math.sin(Date.now() * 0.01 * this.speed) * 5;
            ctx.moveTo(-this.size + 5, 0);
            ctx.lineTo(-this.size - 15, -10 + tailWag);
            ctx.lineTo(-this.size - 15, 10 + tailWag);
            ctx.fill();

            // Mata
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(this.size/2, -this.size/6, this.size/5, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(this.size/2 + 2, -this.size/6, this.size/10, 0, Math.PI*2);
            ctx.fill();

            // HP Bar untuk Boss
            if (this.maxHp > 1 && this.hp < this.maxHp) {
                ctx.fillStyle = 'red';
                ctx.fillRect(-20, -this.size, 40, 5);
                ctx.fillStyle = '#0f0';
                ctx.fillRect(-20, -this.size, 40 * (this.hp / this.maxHp), 5);
            }

            ctx.restore();
        }
    }

    class Bullet {
        constructor(angle, power) {
            this.x = width / 2;
            this.y = height;
            this.speed = 10;
            this.angle = angle;
            this.radius = power === 2 ? 8 : 4; // Ukuran peluru
            this.power = power === 2 ? 3 : 1; // Damage
            this.active = true;
            this.color = power === 2 ? '#ff0055' : '#ffff00';
            
            this.vx = Math.cos(angle) * this.speed;
            this.vy = Math.sin(angle) * this.speed;
        }

        update() {
            this.x += this.vx;
            this.y += this.vy;

            if (this.x < 0 || this.x > width || this.y < 0 || this.y > height) {
                this.active = false;
            }
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);
            
            // Efek cahaya peluru
            ctx.shadowBlur = 15;
            ctx.shadowColor = this.color;
            ctx.fillStyle = 'white';
            
            ctx.beginPath();
            ctx.arc(0, 0, this.radius, 0, Math.PI*2);
            ctx.fill();
            
            // Ekor peluru
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.moveTo(-this.radius, -this.radius);
            ctx.lineTo(-this.radius * 4, 0);
            ctx.lineTo(-this.radius, this.radius);
            ctx.fill();

            ctx.restore();
        }
    }

    class Particle { // Untuk ledakan koin / darah
        constructor(x, y, type) {
            this.x = x;
            this.y = y;
            this.type = type; // 'coin' or 'blood'
            this.life = 1;
            this.vx = (Math.random() - 0.5) * 5;
            this.vy = (Math.random() - 0.5) * 5;
            
            if (type === 'coin') {
                this.vy = -3 - Math.random() * 3; // Coin loncat ke atas dulu
                this.grav = 0.2;
            } else {
                this.grav = 0;
            }
        }

        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.life -= 0.02;

            if (this.type === 'coin') {
                this.vy += this.grav; // Gravitasi
                // Coin magnet effect ke UI Balance (Pojok Kanan Atas-ish)
                // Simplifikasi: jatuh ke bawah
            }
        }

        draw() {
            ctx.globalAlpha = this.life;
            if (this.type === 'coin') {
                ctx.fillStyle = '#ffd700';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 8, 0, Math.PI*2);
                ctx.fill();
                ctx.strokeStyle = '#b8860b';
                ctx.stroke();
                ctx.fillStyle = 'black';
                ctx.font = "10px Arial";
                ctx.fillText("$", this.x - 3, this.y + 3);
            } else {
                ctx.fillStyle = '#00d4ff'; // Darah biru/percikan air
                ctx.beginPath();
                ctx.arc(this.x, this.y, Math.random()*3, 0, Math.PI*2);
                ctx.fill();
            }
            ctx.globalAlpha = 1;
        }
    }

    class Cannon {
        constructor() {
            this.angle = -Math.PI / 2;
            this.recoil = 0;
        }
        
        update() {
            // Hitung sudut ke mouse
            const dx = mouse.x - (width / 2);
            const dy = mouse.y - height;
            this.angle = Math.atan2(dy, dx);
            
            if (this.recoil > 0) this.recoil -= 1;
        }

        draw() {
            ctx.save();
            ctx.translate(width / 2, height);
            ctx.rotate(this.angle);
            
            // Recoil effect
            const recoilOffset = this.recoil;

            // Laras Meriam
            ctx.fillStyle = '#333';
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            
            // Bentuk Meriam Futuristik
            ctx.beginPath();
            ctx.rect(0 - recoilOffset, -15, 60, 30); // Base barrel
            ctx.rect(10 - recoilOffset, -20, 10, 40); // Ring detail
            ctx.rect(40 - recoilOffset, -25, 10, 50); // Muzzle ring
            ctx.fill();
            ctx.stroke();

            // Efek neon di meriam
            ctx.shadowBlur = 20;
            ctx.shadowColor = '#00d4ff';
            ctx.fillStyle = '#00d4ff';
            ctx.fillRect(10 - recoilOffset, -2, 40, 4); // Garis energi

            ctx.restore();
            
            // Base Meriam (Setengah lingkaran di bawah)
            ctx.shadowBlur = 0;
            ctx.fillStyle = '#111';
            ctx.beginPath();
            ctx.arc(width/2, height, 40, Math.PI, 0);
            ctx.fill();
            ctx.strokeStyle = '#00d4ff';
            ctx.stroke();
        }
    }

    // --- INSTANTIATION ---
    const fishes = [];
    const bullets = [];
    const particles = [];
    const cannon = new Cannon();

    // Spawn ikan awal
    for(let i=0; i<15; i++) {
        fishes.push(new Fish());
    }

    // --- GAME LOGIC ---

    function shoot(e) {
        // Cek klik di area game (bukan di tombol UI)
        if (e.target.closest('.controls')) return;

        if (balance < bulletCost) {
            alert("Saldo Habis! (Refresh untuk reset)");
            return;
        }

        balance -= bulletCost;
        updateUI();

        cannon.recoil = 10; // Efek hentakan
        bullets.push(new Bullet(cannon.angle, bulletPower));
        
        // Sound effect (opsional, dummy visual shake)
        const ui = document.getElementById('ui-layer');
        ui.style.transform = `translate(${Math.random()*2-1}px, ${Math.random()*2-1}px)`;
        setTimeout(() => ui.style.transform = 'none', 50);
    }

    function setPower(level) {
        bulletPower = level;
        bulletCost = level === 1 ? 10 : 50;
        
        document.getElementById('btn-low').classList.toggle('active', level === 1);
        document.getElementById('btn-high').classList.toggle('active', level === 2);
    }
    
    // Set default active button
    setPower(1);

    function spawnFloatingText(text, x, y) {
        const el = document.createElement('div');
        el.className = 'floating-text';
        el.innerText = "+" + text;
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
    }

    function updateUI() {
        document.getElementById('balanceDisplay').innerText = balance.toLocaleString();
    }

    function loop() {
        // Clear Screen
        ctx.fillStyle = 'rgba(0, 10, 20, 0.3)'; // Trail effect agar smooth
        ctx.fillRect(0, 0, width, height);
        
        // Background Bubbles (Efek dalam laut)
        if (Math.random() < 0.05) {
            particles.push(new Particle(Math.random()*width, height, 'bubble'));
        }

        // Update & Draw Fish
        fishes.forEach(fish => {
            fish.update();
            fish.draw();
        });

        // Update & Draw Bullets
        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i];
            b.update();
            b.draw();

            if (!b.active) {
                bullets.splice(i, 1);
                continue;
            }

            // Collision Detection
            for (let j = fishes.length - 1; j >= 0; j--) {
                let f = fishes[j];
                // Simple Circle Collision
                const dist = Math.hypot(b.x - (f.x), b.y - (f.y));
                
                // Hitbox ikan sedikit lebih kecil dari visualnya
                if (dist < f.size) {
                    // Hit!
                    b.active = false;
                    f.hp -= b.power;
                    
                    // Spawn Blood/Scale particles
                    for(let p=0; p<3; p++) particles.push(new Particle(b.x, b.y, 'blood'));

                    if (f.hp <= 0) {
                        // Ikan Mati
                        balance += f.value;
                        spawnFloatingText(f.value, f.x, f.y);
                        
                        // Spawn Coin explosion
                        for(let k=0; k<5; k++) {
                            particles.push(new Particle(f.x, f.y, 'coin'));
                        }

                        updateUI();
                        f.reset(); // Respawn ikan baru
                    }
                    break; // Satu peluru kena satu ikan
                }
            }
        }

        // Update & Draw Particles
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.update();
            p.draw();
            if (p.life <= 0) particles.splice(i, 1);
        }

        // Draw Cannon
        cannon.update();
        cannon.draw();

        requestAnimationFrame(loop);
    }

    // Start
    canvas.addEventListener('mousedown', shoot);
    loop();

</script>
</body>
</html>
