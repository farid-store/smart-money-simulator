<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ocean Emperor Deluxe</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-gold: #ffd700;
            --neon-red: #ff0055;
            --glass-bg: rgba(0, 15, 30, 0.65);
            --border-glow: 0 0 10px rgba(0, 243, 255, 0.5);
        }

        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: 'Rajdhani', sans-serif;
            user-select: none;
            cursor: none; /* Kita ganti kursor default */
        }

        /* --- GAME CANVAS --- */
        canvas {
            display: block;
            background: radial-gradient(circle at center, #0b3d66 0%, #000411 100%);
        }

        /* --- CUSTOM CURSOR --- */
        #cursor-hair {
            position: absolute;
            width: 40px; height: 40px;
            border: 2px solid var(--neon-red);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 9999;
            box-shadow: 0 0 10px var(--neon-red);
            transition: transform 0.1s;
        }
        #cursor-hair::after {
            content: ''; position: absolute;
            top: 50%; left: 50%;
            width: 4px; height: 4px;
            background: var(--neon-red);
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        /* --- UI LAYOUT --- */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
        }

        /* TOP BAR */
        .top-bar {
            display: flex; justify-content: space-between; padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
        }

        .jackpot-ticker {
            color: var(--neon-gold);
            font-size: 24px; font-weight: bold;
            text-shadow: 0 0 15px var(--neon-gold);
            letter-spacing: 2px;
        }

        /* BOTTOM CONTROL PANEL */
        .control-panel {
            pointer-events: auto;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: 15px 40px;
            display: flex; align-items: center; justify-content: center; gap: 30px;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
            position: relative;
            z-index: 100;
        }

        /* COMPONENTS */
        .balance-box {
            position: relative;
            background: rgba(0,0,0,0.5);
            padding: 10px 25px;
            border-radius: 8px;
            border: 1px solid var(--neon-gold);
            color: var(--neon-gold);
            font-size: 28px;
            font-weight: 700;
            min-width: 150px; text-align: right;
            box-shadow: inset 0 0 20px rgba(255, 215, 0, 0.1);
        }
        .balance-label {
            font-size: 12px; color: #aaa; position: absolute; top: -8px; left: 10px; background: #060b14; padding: 0 5px;
        }

        .btn-group { display: flex; align-items: center; gap: 10px; }

        .btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--neon-blue);
            color: var(--neon-blue);
            padding: 12px 20px;
            border-radius: 6px;
            font-family: 'Rajdhani'; font-weight: bold; font-size: 16px;
            cursor: pointer;
            transition: 0.2s;
            text-transform: uppercase;
        }
        .btn:hover { background: rgba(0, 243, 255, 0.2); box-shadow: 0 0 15px var(--neon-blue); }
        .btn:active { transform: scale(0.95); }

        .btn.active {
            background: var(--neon-blue);
            color: black;
            box-shadow: 0 0 20px var(--neon-blue);
        }

        .bet-adjust {
            display: flex; flex-direction: column; align-items: center;
        }
        .bet-val { font-size: 20px; color: white; font-weight: bold; margin: 0 10px; }

        /* Floating Damage Text */
        .floater {
            position: absolute; pointer-events: none;
            font-weight: 900; font-size: 24px;
            animation: floatUp 0.8s forwards ease-out;
            text-shadow: 2px 2px 0px #000;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { transform: translateY(-10px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-80px) scale(1); opacity: 0; }
        }

        /* Screen Shake */
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 
            10%, 90% { transform: translate3d(-1px, 0, 0); } 
            20%, 80% { transform: translate3d(2px, 0, 0); } 
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 
            40%, 60% { transform: translate3d(4px, 0, 0); } 
        }

    </style>
</head>
<body>

<div id="cursor-hair"></div>

<canvas id="gameCanvas"></canvas>

<div id="ui-layer">
    <div class="top-bar">
        <div class="jackpot-ticker">GRAND JACKPOT: ðŸ’Ž 5,402,100</div>
    </div>

    <div class="control-panel">
        <div class="btn-group">
            <button class="btn" onclick="adjustBet(-10)">-</button>
            <div class="bet-adjust">
                <span style="font-size: 10px; color: #888;">BET</span>
                <span class="bet-val" id="bet-display">10</span>
            </div>
            <button class="btn" onclick="adjustBet(10)">+</button>
        </div>

        <div class="balance-box" id="balance-container">
            <span class="balance-label">CREDIT</span>
            <span id="balance">10000</span>
        </div>

        <button class="btn" id="btn-auto" onclick="toggleAuto()">
            AUTO SHOOT: <span id="auto-status">OFF</span>
        </button>
    </div>
</div>

<script>
    /* --- CONFIG & STATE --- */
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const cursor = document.getElementById('cursor-hair');
    const balanceEl = document.getElementById('balance');
    const balanceContainer = document.getElementById('balance-container');

    let width, height;
    let balance = 10000;
    let bet = 10;
    
    // Auto Shoot State
    let isAuto = false;
    let autoInterval = null;
    let lastShotTime = 0;
    
    // Mouse State
    let mouse = { x: 0, y: 0, down: false };

    // Resize
    function resize() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // Mouse Tracking
    window.addEventListener('mousemove', e => {
        mouse.x = e.clientX;
        mouse.y = e.clientY;
        cursor.style.left = e.clientX + 'px';
        cursor.style.top = e.clientY + 'px';
    });
    
    // Click Handling (Manual Shoot)
    window.addEventListener('mousedown', (e) => {
        if(e.target.closest('.control-panel')) return; // Jangan nembak kalau klik UI
        mouse.down = true;
        if(!isAuto) shoot();
    });
    window.addEventListener('mouseup', () => mouse.down = false);

    /* --- GAME OBJECTS --- */
    const bullets = [];
    const fishes = [];
    const particles = [];
    const coins = []; // Coin flying animation

    // --- CLASSES ---

    class Fish {
        constructor() {
            this.reset();
        }

        reset() {
            this.id = Math.random();
            this.h = Math.random() * (height - 200) + 50; // Height
            this.dir = Math.random() > 0.5 ? 1 : -1;
            this.x = this.dir === 1 ? -100 : width + 100;
            this.y = this.h;
            
            // Randomize Type
            const r = Math.random();
            if (r < 0.05) {
                this.type = 'boss'; this.hp = 50; this.maxHp = 50; this.val = 500;
                this.speed = 0.5; this.size = 60; this.color = '#ffd700';
            } else if (r < 0.2) {
                this.type = 'med'; this.hp = 10; this.maxHp = 10; this.val = 50;
                this.speed = 1.5; this.size = 35; this.color = '#ff0055';
            } else {
                this.type = 'sml'; this.hp = 2; this.maxHp = 2; this.val = 10;
                this.speed = 2.5; this.size = 20; this.color = '#00f3ff';
            }
            this.wiggleOffset = Math.random() * 100;
        }

        update() {
            this.x += this.speed * this.dir;
            this.y = this.h + Math.sin((this.x + this.wiggleOffset) * 0.01) * 20;
            
            // Out of bounds
            if ((this.dir === 1 && this.x > width + 100) || (this.dir === -1 && this.x < -100)) {
                this.reset();
            }
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.scale(this.dir, 1); // Flip based on direction

            // Glow Effect
            ctx.shadowBlur = 15;
            ctx.shadowColor = this.color;

            // Body
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.ellipse(0, 0, this.size, this.size/1.8, 0, 0, Math.PI*2);
            ctx.fill();

            // Tail Animation
            const tailWag = Math.sin(Date.now() / 100 * this.speed) * 10;
            ctx.beginPath();
            ctx.moveTo(-this.size + 5, 0);
            ctx.lineTo(-this.size - 20, -15 + tailWag);
            ctx.lineTo(-this.size - 20, 15 + tailWag);
            ctx.fill();

            // Fins
            ctx.beginPath();
            ctx.moveTo(0, -this.size/2);
            ctx.quadraticCurveTo(5, -this.size, 15, -this.size/2);
            ctx.fill();

            // HP Bar (Only for Boss)
            if (this.type === 'boss') {
                ctx.shadowBlur = 0;
                ctx.fillStyle = 'red';
                ctx.fillRect(-30, -this.size - 20, 60, 6);
                ctx.fillStyle = '#0f0';
                ctx.fillRect(-30, -this.size - 20, 60 * (this.hp/this.maxHp), 6);
            }

            ctx.restore();
        }
    }

    class Bullet {
        constructor(angle) {
            this.x = width/2;
            this.y = height - 80; // Cannon position
            this.angle = angle;
            this.speed = 12;
            this.active = true;
            this.damage = 1; // Base damage
        }
        
        update() {
            this.x += Math.cos(this.angle) * this.speed;
            this.y += Math.sin(this.angle) * this.speed;
            if (this.x < 0 || this.x > width || this.y < 0 || this.y > height) this.active = false;
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);
            
            // Neon Bullet
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#fff';
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(0,0, 6, 0, Math.PI*2); ctx.fill();
            
            // Trail
            ctx.shadowBlur = 20;
            ctx.shadowColor = varColor('--neon-blue');
            ctx.fillStyle = varColor('--neon-blue');
            ctx.fillRect(-20, -4, 20, 8);
            
            ctx.restore();
        }
    }

    class Coin {
        constructor(startX, startY, value) {
            this.x = startX;
            this.y = startY;
            this.val = value;
            this.size = 12;
            this.life = 1;
            
            // Target Position (The UI Balance Box)
            const rect = balanceContainer.getBoundingClientRect();
            this.targetX = rect.left + rect.width / 2;
            this.targetY = rect.top + rect.height / 2;
            
            // Physics
            this.vx = (Math.random() - 0.5) * 10;
            this.vy = -10 - Math.random() * 5; // Pop up first
        }

        update() {
            // First phase: Pop up
            if (this.vy < 0 || this.life > 0.8) {
                this.vy += 0.5; // Gravity
                this.x += this.vx;
                this.y += this.vy;
            } else {
                // Second phase: Fly to wallet
                const dx = this.targetX - this.x;
                const dy = this.targetY - this.y;
                this.x += dx * 0.1; // Lerp speed
                this.y += dy * 0.1;
                
                if (Math.abs(dx) < 10 && Math.abs(dy) < 10) {
                    this.life = 0; // Arrived
                    balance += this.val; // Add real balance
                    updateUI();
                    pulseWallet();
                }
            }
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            
            // Spin animation
            const scaleX = Math.sin(Date.now() / 50);
            ctx.scale(scaleX, 1);
            
            ctx.shadowBlur = 5;
            ctx.shadowColor = 'gold';
            ctx.fillStyle = '#ffd700';
            ctx.beginPath(); ctx.arc(0,0, this.size, 0, Math.PI*2); ctx.fill();
            
            ctx.fillStyle = '#b8860b';
            ctx.beginPath(); ctx.arc(0,0, this.size * 0.7, 0, Math.PI*2); ctx.fill();
            
            ctx.fillStyle = '#fff';
            ctx.font = '10px Arial';
            ctx.fillText('$', -3, 3);
            
            ctx.restore();
        }
    }

    // --- SYSTEMS ---

    function varColor(name) {
        return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
    }

    function shoot() {
        if (balance < bet) return alert("Saldo Habis!");
        
        balance -= bet;
        updateUI();
        
        // Recoil UI
        const panel = document.querySelector('.control-panel');
        panel.style.transform = "translateY(5px)";
        setTimeout(() => panel.style.transform = "translateY(0)", 100);

        // Calculate Angle
        const dx = mouse.x - width/2;
        const dy = mouse.y - (height - 80);
        const angle = Math.atan2(dy, dx);
        
        bullets.push(new Bullet(angle));
        
        // Muzzle Flash Effect (Particle)
        for(let i=0; i<5; i++) {
            particles.push({
                x: width/2 + Math.cos(angle)*50, 
                y: height-80 + Math.sin(angle)*50,
                vx: Math.cos(angle)*5 + (Math.random()-0.5)*5,
                vy: Math.sin(angle)*5 + (Math.random()-0.5)*5,
                life: 1, color: '#fff'
            });
        }
    }

    function toggleAuto() {
        isAuto = !isAuto;
        const btn = document.getElementById('btn-auto');
        const status = document.getElementById('auto-status');
        
        if (isAuto) {
            btn.classList.add('active');
            status.innerText = "ON";
            cursor.style.borderColor = "#00f3ff"; // Blue cursor for auto
        } else {
            btn.classList.remove('active');
            status.innerText = "OFF";
            cursor.style.borderColor = "#ff0055"; // Red cursor
        }
    }

    function adjustBet(amount) {
        if (bet + amount >= 10 && bet + amount <= 500) {
            bet += amount;
            document.getElementById('bet-display').innerText = bet;
        }
    }

    function updateUI() {
        balanceEl.innerText = balance.toLocaleString();
    }

    function pulseWallet() {
        balanceContainer.style.transform = "scale(1.1)";
        balanceContainer.style.borderColor = "#fff";
        setTimeout(() => {
            balanceContainer.style.transform = "scale(1)";
            balanceContainer.style.borderColor = "#ffd700";
        }, 100);
    }

    function spawnFloatingText(txt, x, y, color) {
        const el = document.createElement('div');
        el.className = 'floater';
        el.innerText = txt;
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.style.color = color;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 800);
    }

    // --- MAIN LOOP ---

    // Init Spawn
    for(let i=0; i<15; i++) fishes.push(new Fish());

    function loop() {
        // 1. Auto Shoot Logic
        if (isAuto && mouse.down) { // Must hold click? No, usually toggle means auto-fire at cursor
            // Actually, usually "Auto" in casino means "Always fire". 
            // Let's make it fire continuously if toggled ON.
            const now = Date.now();
            if (now - lastShotTime > 200) { // Fire rate limiter
                shoot();
                lastShotTime = now;
            }
        }

        // 2. Clear & Background
        ctx.clearRect(0, 0, width, height);
        
        // God Rays (Background Effect)
        ctx.save();
        ctx.globalCompositeOperation = 'overlay';
        const grad = ctx.createLinearGradient(0, 0, width, height);
        grad.addColorStop(0, 'rgba(255, 255, 255, 0.1)');
        grad.addColorStop(1, 'rgba(0, 0, 0, 0)');
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.moveTo(width/2 - 200, 0);
        ctx.lineTo(width/2 + 200, 0);
        ctx.lineTo(width, height);
        ctx.lineTo(0, height);
        ctx.fill();
        ctx.restore();

        // 3. Draw Cannon Base
        ctx.save();
        ctx.translate(width/2, height - 80);
        const angle = Math.atan2(mouse.y - (height - 80), mouse.x - width/2);
        ctx.rotate(angle);
        
        // Cannon Barrel
        ctx.fillStyle = '#333';
        ctx.shadowBlur = 20; ctx.shadowColor = '#00f3ff';
        ctx.fillRect(0, -15, 80, 30);
        // Neon Strips
        ctx.fillStyle = '#00f3ff';
        ctx.fillRect(10, -5, 60, 10);
        ctx.restore();

        // Cannon Body
        ctx.beginPath(); 
        ctx.arc(width/2, height - 40, 60, Math.PI, 0); 
        ctx.fillStyle = '#111'; ctx.fill();
        ctx.lineWidth = 3; ctx.strokeStyle = '#00f3ff'; ctx.stroke();


        // 4. Update Entities
        
        // Fishes
        fishes.forEach(f => {
            f.update();
            f.draw();
        });

        // Bullets
        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i];
            b.update();
            b.draw();

            if (!b.active) { bullets.splice(i, 1); continue; }

            // Collision
            for (let f of fishes) {
                const dist = Math.hypot(b.x - f.x, b.y - f.y);
                if (dist < f.size + 10) {
                    b.active = false;
                    f.hp -= 1;
                    
                    // Hit Effect
                    particles.push({
                        x: b.x, y: b.y, vx: (Math.random()-0.5)*5, vy: (Math.random()-0.5)*5, 
                        life: 1, color: '#fff'
                    });

                    if (f.hp <= 0) {
                        // Kill Logic
                        spawnFloatingText("+" + (f.val * (bet/10)), f.x, f.y, '#ffd700');
                        
                        // Spawn Flying Coins
                        const coinCount = Math.min(10, Math.floor(f.val / 5)); // Don't spawn too many
                        for(let k=0; k<coinCount; k++) {
                            coins.push(new Coin(f.x, f.y, (f.val * (bet/10)) / coinCount));
                        }

                        // Screen Shake for Boss
                        if(f.type === 'boss') document.body.classList.add('shake');

                        f.reset();
                    }
                    break;
                }
            }
        }

        // Coins (Flying to wallet)
        for (let i = coins.length - 1; i >= 0; i--) {
            let c = coins[i];
            c.update();
            c.draw();
            if (c.life === 0) coins.splice(i, 1);
        }

        // Particles
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.05;
            
            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.color;
            ctx.beginPath(); ctx.arc(p.x, p.y, 3, 0, Math.PI*2); ctx.fill();
            ctx.globalAlpha = 1;
            
            if (p.life <= 0) particles.splice(i, 1);
        }

        // Remove Shake Class
        if(document.body.classList.contains('shake')) {
            setTimeout(() => document.body.classList.remove('shake'), 500);
        }

        requestAnimationFrame(loop);
    }

    loop();

</script>
</body>
</html>
