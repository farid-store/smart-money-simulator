<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ocean Emperor: Ultimate Weapon Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-gold: #ffd700;
            --neon-red: #ff0055;
            --neon-green: #00ff66;
            --glass-bg: rgba(0, 15, 30, 0.75);
        }

        body {
            margin: 0; overflow: hidden; background: #000;
            font-family: 'Rajdhani', sans-serif;
            user-select: none; cursor: crosshair;
        }

        canvas { display: block; background: radial-gradient(circle at center, #0b3d66 0%, #000411 100%); }

        /* UI LAYER */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
        }

        /* TOP HUD */
        .hud-top {
            display: flex; justify-content: space-between; padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
        }

        .weapon-timer-bar {
            position: absolute; top: 80px; left: 50%; transform: translateX(-50%);
            width: 300px; height: 10px; background: #333; border-radius: 5px;
            display: none; border: 1px solid white; overflow: hidden;
        }
        .weapon-fill {
            height: 100%; background: var(--neon-red); width: 100%;
            transition: width 0.1s linear;
        }

        /* BOTTOM HUD */
        .hud-bottom {
            pointer-events: auto;
            background: var(--glass-bg); backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255,255,255,0.2);
            padding: 15px 40px;
            display: flex; align-items: center; justify-content: center; gap: 40px;
        }

        .stat-box {
            text-align: center; color: white;
        }
        .stat-val {
            font-size: 28px; font-weight: 900; color: var(--neon-gold);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        .stat-label { font-size: 12px; color: #aaa; letter-spacing: 2px; }

        .btn {
            background: transparent; border: 1px solid var(--neon-blue);
            color: var(--neon-blue); padding: 10px 20px;
            font-family: inherit; font-weight: bold; cursor: pointer;
            transition: 0.2s;
        }
        .btn:hover { background: var(--neon-blue); color: black; }
        .btn.active { background: var(--neon-green); color: black; border-color: var(--neon-green); }

        /* Floating Text Animation */
        .floater {
            position: absolute; font-weight: 900; font-size: 24px;
            animation: floatUp 1s forwards; text-shadow: 2px 2px 0 #000;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { transform: translateY(-20px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-100px) scale(1); opacity: 0; }
        }
        
        /* Shake Screen */
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(0,0); } }
    </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="ui-layer">
    <div class="hud-top">
        <div class="stat-box" style="text-align: left;">
            <div class="stat-label">GRAND JACKPOT</div>
            <div class="stat-val">ðŸ’Ž 9,999,999</div>
        </div>
    </div>

    <div id="weapon-timer" class="weapon-timer-bar">
        <div id="weapon-fill" class="weapon-fill"></div>
    </div>

    <div class="hud-bottom">
        <div class="stat-box">
            <div class="stat-label">SALDO</div>
            <div class="stat-val" id="balance">10,000</div>
        </div>
        
        <div class="stat-box">
            <button class="btn" id="btn-auto" onclick="toggleAuto()">AUTO FIRE: OFF</button>
        </div>

        <div class="stat-box">
            <div class="stat-label">BET</div>
            <div class="stat-val" style="color: white; font-size: 20px;">
                <span style="cursor:pointer" onclick="changeBet(-10)">[-]</span> 
                <span id="bet">10</span> 
                <span style="cursor:pointer" onclick="changeBet(10)">[+]</span>
            </div>
        </div>
    </div>
</div>

<script>
    /**
     * ==========================================
     * KONFIGURASI ASET (GAMBAR)
     * ==========================================
     * Jika Anda ingin menggunakan gambar asli, isi URL di dalam tanda kutip.
     * Jika kosong (""), game akan menggambar bentuk prosedural (Canvas Shape).
     */
    const ASSETS = {
        bg: "",                 // URL Background image
        fish_small: "",         // URL Ikan Kecil
        fish_med: "",           // URL Ikan Sedang
        fish_boss: "",          // URL Boss
        fish_drill: "",         // URL Ikan Spesial (Drop Drill)
        fish_bomb: "",          // URL Ikan Spesial (Drop Bomb)
        fish_jackpot: "",       // URL Ikan Count Up
        bullet_normal: "",      // URL Peluru Biasa
        bullet_drill: "",       // URL Peluru Drill
        bullet_bomb: "",        // URL Bom Bergerak
        coin: ""                // URL Koin
    };

    // Preload Images Helper
    const images = {};
    for (let key in ASSETS) {
        if (ASSETS[key]) {
            const img = new Image();
            img.src = ASSETS[key];
            images[key] = img;
        }
    }

    // --- GAME ENGINE SETUP ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let width, height;
    function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    // --- STATE VARIABLES ---
    let balance = 10000;
    let bet = 10;
    let autoFire = false;
    let mouse = { x: width/2, y: height/2, down: false };

    // Weapon State
    let specialWeapon = null; // 'drill' or 'bomb'
    let specialTimer = 0;     // Frames remaining
    let specialMaxTime = 0;   // Untuk progress bar

    // Entities Arrays
    const fishes = [];
    const bullets = [];
    const particles = [];
    const texts = [];

    // --- CLASSES ---

    class Fish {
        constructor() {
            this.reset();
        }

        reset() {
            this.id = Math.random();
            this.y = Math.random() * (height - 200) + 100;
            this.dir = Math.random() > 0.5 ? 1 : -1;
            this.x = this.dir === 1 ? -100 : width + 100;
            
            // Tentukan Tipe Ikan & Probabilitas
            const r = Math.random();
            this.scale = 1;
            this.angle = 0;
            this.countUpVal = 0;

            if (r < 0.02) {
                this.type = 'drill_fish'; // DROP DRILL
                this.hp = 30; this.maxHp = 30; this.val = 200;
                this.speed = 1.5; this.size = 40; this.color = '#00f3ff';
            } else if (r < 0.04) {
                this.type = 'bomb_fish'; // DROP BOMB
                this.hp = 30; this.maxHp = 30; this.val = 200;
                this.speed = 1.5; this.size = 40; this.color = '#ff0055';
            } else if (r < 0.07) {
                this.type = 'jackpot'; // COUNT UP
                this.hp = 50; this.maxHp = 50; this.baseVal = 100; this.val = 100;
                this.speed = 0.8; this.size = 45; this.color = '#ffd700';
            } else if (r < 0.2) {
                this.type = 'boss';
                this.hp = 80; this.maxHp = 80; this.val = 500;
                this.speed = 0.5; this.size = 60; this.color = '#ff9900';
            } else {
                this.type = 'normal';
                this.hp = 3; this.maxHp = 3; this.val = 10;
                this.speed = 2 + Math.random(); this.size = 20; this.color = '#ffffff';
            }
        }

        update() {
            this.x += this.speed * this.dir;
            this.y += Math.sin(this.x * 0.01) * 1.5; // Gerakan bergelombang

            // Logic Count Up Fish
            if (this.type === 'jackpot') {
                if (Math.floor(Date.now() / 100) % 5 === 0) { // Setiap 0.5 detik
                    this.val += 5; // Nilai naik terus
                }
            }

            // Respawn jika keluar layar
            if ((this.dir === 1 && this.x > width + 100) || (this.dir === -1 && this.x < -100)) {
                this.reset();
            }
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.scale(this.dir, 1);

            // 1. CEK APAKAH ADA GAMBAR ASET?
            let imgKey = null;
            if (this.type === 'drill_fish') imgKey = 'fish_drill';
            else if (this.type === 'bomb_fish') imgKey = 'fish_bomb';
            else if (this.type === 'jackpot') imgKey = 'fish_jackpot';
            else if (this.type === 'boss') imgKey = 'fish_boss';
            else imgKey = 'fish_small';

            if (images[imgKey]) {
                // Render Image
                const img = images[imgKey];
                ctx.drawImage(img, -this.size, -this.size/2, this.size*2, this.size);
            } else {
                // Render Procedural (Fallback jika tidak ada gambar)
                ctx.shadowBlur = 15; ctx.shadowColor = this.color;
                ctx.fillStyle = this.color;
                
                // Badan Utama
                ctx.beginPath();
                ctx.ellipse(0, 0, this.size, this.size/1.6, 0, 0, Math.PI*2);
                ctx.fill();

                // Ekor
                ctx.beginPath();
                const tailWag = Math.sin(Date.now()/100 * this.speed) * 10;
                ctx.moveTo(-this.size + 5, 0);
                ctx.lineTo(-this.size - 20, -15 + tailWag);
                ctx.lineTo(-this.size - 20, 15 + tailWag);
                ctx.fill();

                // Tanda Spesial
                if (this.type === 'drill_fish') {
                    ctx.fillStyle = 'black'; ctx.font="bold 20px Arial"; 
                    ctx.scale(this.dir, 1); ctx.fillText("âš¡", -5, 5);
                } else if (this.type === 'bomb_fish') {
                    ctx.fillStyle = 'black'; ctx.font="bold 20px Arial"; 
                    ctx.scale(this.dir, 1); ctx.fillText("ðŸ’£", -8, 5);
                }
            }

            // Draw Jackpot Counter
            if (this.type === 'jackpot') {
                ctx.scale(this.dir, 1); // Reset flip text
                ctx.fillStyle = '#fff'; ctx.font = "bold 16px Rajdhani";
                ctx.shadowBlur = 0;
                ctx.fillText(`$${this.val}`, -20, -this.size - 10);
            }

            // Boss HP Bar
            if (this.maxHp > 10) {
                ctx.fillStyle = 'red'; ctx.fillRect(-20, -this.size-10, 40, 4);
                ctx.fillStyle = '#0f0'; ctx.fillRect(-20, -this.size-10, 40 * (this.hp/this.maxHp), 4);
            }

            ctx.restore();
        }
    }

    class SpecialWeapon {
        constructor(type) {
            this.type = type; // 'drill' or 'bomb'
            this.active = true;
            this.x = width / 2;
            this.y = height / 2;
            this.vx = (Math.random() - 0.5) * 10;
            this.vy = (Math.random() - 0.5) * 10;
            
            // DRILL: Bounces around screen
            // BOMB: Floats around then explodes
            
            this.angle = 0;
        }

        update() {
            // Physics Movement
            this.x += this.vx;
            this.y += this.vy;

            // Bounce Logic
            if (this.x < 0 || this.x > width) this.vx *= -1;
            if (this.y < 0 || this.y > height) this.vy *= -1;

            this.angle += 0.2; // Rotation

            // COLLISION DAMAGE (Continuous Damage Area)
            fishes.forEach(f => {
                const dist = Math.hypot(this.x - f.x, this.y - f.y);
                const range = this.type === 'drill' ? 60 : 100;
                
                if (dist < range) {
                    // Drill damage kecil tapi cepat (DPS tinggi)
                    f.hp -= 0.5; 
                    spawnParticle(f.x, f.y, 'hit');
                    
                    if (f.hp <= 0) handleFishDeath(f);
                }
            });
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);

            if (this.type === 'drill') {
                if(images.bullet_drill) {
                    ctx.drawImage(images.bullet_drill, -30, -30, 60, 60);
                } else {
                    // Procedural Drill
                    ctx.fillStyle = '#00f3ff'; ctx.shadowBlur = 20; ctx.shadowColor = '#00f3ff';
                    ctx.beginPath(); 
                    ctx.moveTo(0, -40); ctx.lineTo(15, 0); ctx.lineTo(0, 40); ctx.lineTo(-15, 0); 
                    ctx.fill();
                    // Sparks
                    ctx.strokeStyle = 'white'; ctx.lineWidth = 2;
                    ctx.beginPath(); ctx.arc(0,0, 30, 0, Math.PI*2); ctx.stroke();
                }
            } else {
                if(images.bullet_bomb) {
                    ctx.drawImage(images.bullet_bomb, -40, -40, 80, 80);
                } else {
                    // Procedural Bomb
                    ctx.fillStyle = '#ff0055'; ctx.shadowBlur = 20; ctx.shadowColor = '#ff0055';
                    ctx.beginPath(); ctx.arc(0,0, 30, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = 'white'; ctx.font="20px Arial"; ctx.fillText("â˜¢", -10, 8);
                }
            }
            ctx.restore();
        }
    }

    class Bullet {
        constructor(angle) {
            this.x = width/2; this.y = height - 50;
            this.vx = Math.cos(angle) * 15;
            this.vy = Math.sin(angle) * 15;
            this.active = true;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            if (this.x < 0 || this.x > width || this.y < 0 || this.y > height) this.active = false;
        }
        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.fillStyle = '#ffd700'; ctx.shadowBlur = 10; ctx.shadowColor = 'gold';
            ctx.beginPath(); ctx.arc(0,0, 5, 0, Math.PI*2); ctx.fill();
            ctx.restore();
        }
    }

    // --- GAME LOGIC FUNCTIONS ---

    function activateSpecial(type) {
        specialWeapon = new SpecialWeapon(type);
        specialMaxTime = (type === 'drill' ? 15 : 10) * 60; // 60 FPS
        specialTimer = specialMaxTime;
        
        // Show Timer UI
        document.getElementById('weapon-timer').style.display = 'block';
        document.getElementById('weapon-fill').style.width = '100%';
        
        spawnText(type.toUpperCase() + " MODE!", width/2, height/2, '#fff');
    }

    function spawnParticle(x, y, type) {
        // Simplified particle push
        particles.push({x, y, life: 1, type, vx: (Math.random()-0.5)*5, vy: (Math.random()-0.5)*5});
    }

    function spawnText(str, x, y, color) {
        const el = document.createElement('div');
        el.className = 'floater';
        el.innerText = str;
        el.style.left = x + 'px'; el.style.top = y + 'px'; el.style.color = color;
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
    }

    function handleFishDeath(f) {
        f.hp = 0; // Ensure dead
        
        // 1. REWARD LOGIC
        const win = f.val * (bet / 10);
        balance += win;
        spawnText(`+${Math.floor(win)}`, f.x, f.y, '#ffd700');
        updateUI();

        // 2. CHECK HIDDEN REWARDS
        if (f.type === 'drill_fish') activateSpecial('drill');
        if (f.type === 'bomb_fish') activateSpecial('bomb');
        if (f.type === 'jackpot') spawnText("JACKPOT!", width/2, height/3, '#ffd700');

        // 3. EXPLOSION EFFECT
        for(let i=0; i<8; i++) spawnParticle(f.x, f.y, 'coin');
        
        f.reset(); // Respawn
    }

    function explodeArea() {
        // Layar Getar
        document.body.classList.add('shake');
        setTimeout(() => document.body.classList.remove('shake'), 500);

        // Kill Radius
        const cx = specialWeapon.x;
        const cy = specialWeapon.y;
        
        fishes.forEach(f => {
            const dist = Math.hypot(f.x - cx, f.y - cy);
            if (dist < 300) { // Big Boom Radius
                handleFishDeath(f);
            }
        });

        // Visual Boom
        for(let i=0; i<50; i++) spawnParticle(cx, cy, 'boom');
    }

    function shoot() {
        if (specialWeapon) return; // Cannot shoot manually during special mode
        if (balance < bet) return;
        
        balance -= bet;
        updateUI();
        
        const angle = Math.atan2(mouse.y - (height-50), mouse.x - width/2);
        bullets.push(new Bullet(angle));
    }

    // --- MAIN LOOP ---

    // Init Fishes
    for(let i=0; i<15; i++) fishes.push(new Fish());

    function loop() {
        ctx.clearRect(0, 0, width, height);

        // Draw Background (Asset or Gradient)
        if (images.bg) {
            ctx.drawImage(images.bg, 0, 0, width, height);
        } else {
            // God Rays
            const g = ctx.createLinearGradient(0,0,0,height);
            g.addColorStop(0, '#001e36'); g.addColorStop(1, '#000');
            ctx.fillStyle = g; ctx.fillRect(0,0,width,height);
        }

        // 1. Handle Special Weapon
        if (specialWeapon) {
            specialWeapon.update();
            specialWeapon.draw();
            
            specialTimer--;
            
            // Update Bar UI
            const pct = (specialTimer / specialMaxTime) * 100;
            document.getElementById('weapon-fill').style.width = pct + '%';

            if (specialTimer <= 0) {
                // Time's up!
                explodeArea(); // BOOM di akhir durasi
                specialWeapon = null;
                document.getElementById('weapon-timer').style.display = 'none';
            }
        }

        // 2. Handle Auto Shoot
        if (autoFire && !specialWeapon && balance >= bet) {
            if (Date.now() % 200 < 20) shoot(); // Fire rate limiter
        }

        // 3. Update Fishes
        fishes.forEach(f => {
            f.update();
            f.draw();
        });

        // 4. Update Bullets (Normal)
        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i];
            b.update();
            b.draw();
            
            if(!b.active) { bullets.splice(i,1); continue; }

            // Collision
            for (let f of fishes) {
                if (Math.hypot(b.x - f.x, b.y - f.y) < f.size + 10) {
                    b.active = false;
                    f.hp--;
                    spawnParticle(b.x, b.y, 'hit');
                    if(f.hp <= 0) handleFishDeath(f);
                    break;
                }
            }
        }

        // 5. Particles
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.05;
            ctx.globalAlpha = p.life;
            ctx.fillStyle = p.type === 'coin' ? 'gold' : (p.type === 'boom' ? 'orange' : 'white');
            const size = p.type === 'boom' ? 10 : 3;
            ctx.beginPath(); ctx.arc(p.x, p.y, size, 0, Math.PI*2); ctx.fill();
            if(p.life <= 0) particles.splice(i,1);
        }
        ctx.globalAlpha = 1;

        // Cannon Drawing
        const angle = Math.atan2(mouse.y - (height-50), mouse.x - width/2);
        ctx.save();
        ctx.translate(width/2, height-50);
        ctx.rotate(angle);
        ctx.fillStyle = specialWeapon ? '#ff0055' : '#333'; // Merah jika weapon aktif
        ctx.fillRect(0, -15, 60, 30);
        ctx.restore();

        ctx.beginPath(); ctx.arc(width/2, height-50, 40, Math.PI, 0); 
        ctx.fillStyle = '#111'; ctx.fill(); ctx.strokeStyle='#00f3ff'; ctx.stroke();

        requestAnimationFrame(loop);
    }

    // --- INPUTS ---
    window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
    window.addEventListener('mousedown', (e) => {
        if (!e.target.closest('.hud-bottom')) shoot();
    });

    function toggleAuto() {
        autoFire = !autoFire;
        const btn = document.getElementById('btn-auto');
        btn.innerText = autoFire ? "AUTO FIRE: ON" : "AUTO FIRE: OFF";
        btn.classList.toggle('active', autoFire);
    }

    function changeBet(val) {
        if(bet + val >= 10) bet += val;
        document.getElementById('bet').innerText = bet;
    }

    function updateUI() {
        document.getElementById('balance').innerText = balance.toLocaleString();
    }

    loop();

</script>
</body>
</html>
