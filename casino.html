<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Casino Hunter: Hidden Rewards</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #000510;
            font-family: 'Orbitron', sans-serif;
            user-select: none;
        }

        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        .hud-top {
            display: flex; justify-content: space-between; align-items: center;
        }

        .balance-container {
            background: linear-gradient(90deg, #1a1a2e, #16213e);
            border: 2px solid #ffd700;
            padding: 10px 25px;
            border-radius: 50px;
            color: #ffd700;
            font-size: 24px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
            text-shadow: 0 0 5px #000;
        }

        .special-status {
            font-size: 18px; color: #00d4ff; text-shadow: 0 0 10px #00d4ff;
            display: none;
        }

        canvas { display: block; background: linear-gradient(to bottom, #02111b, #000000); }

        /* Notifikasi Pop-up */
        .pop-msg {
            position: absolute; font-weight: 900; font-size: 2rem;
            color: #fff; animation: popUp 0.8s ease-out forwards;
            pointer-events: none; -webkit-text-stroke: 1px black;
        }

        @keyframes popUp {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: translateY(-50px) scale(1); opacity: 0; }
        }

        .screen-shake { animation: shake 0.5s; }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
    </style>
</head>
<body id="gameBody">

<canvas id="gameCanvas"></canvas>

<div id="ui-layer">
    <div class="hud-top">
        <div class="balance-container">ðŸª™ <span id="balance">5000</span></div>
        <div id="drill-status" class="special-status">âš¡ DRILL MODE ACTIVATED âš¡</div>
    </div>
    <div style="text-align: center; color: #555; font-size: 12px; margin-bottom: 10px;">
        Klik Kiri: Tembak | Klik Kanan: Ganti Senjata
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const body = document.getElementById('gameBody');
    
    let width, height;
    function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
    window.addEventListener('resize', resize);
    resize();

    // --- STATE ---
    let balance = 5000;
    let particles = [];
    let fishes = [];
    let bullets = [];
    let drillMode = false; // Mode senjata tembus
    let drillTimer = 0;

    const MOUSE = { x: width/2, y: height/2 };
    canvas.addEventListener('mousemove', e => { MOUSE.x = e.clientX; MOUSE.y = e.clientY; });

    // --- CLASSES ---

    class Fish {
        constructor() {
            this.reset();
        }

        reset() {
            this.y = Math.random() * (height - 150) + 50;
            this.direction = Math.random() > 0.5 ? 1 : -1;
            this.x = this.direction === 1 ? -100 : width + 100;
            this.angle = 0;
            
            // TIPE IKAN (Random Probability)
            const rand = Math.random();
            
            if (rand < 0.02) {
                this.type = 'bomb'; // 2% BOM LAUT
                this.maxHp = 10;
                this.speed = 0.5;
                this.size = 40;
                this.value = 0; // Hadiahnya adalah ledakan
                this.color = '#333';
            } else if (rand < 0.05) {
                this.type = 'multiplier'; // 3% IKAN MULTIPLIER (Hitungan Naik)
                this.maxHp = 15;
                this.speed = 1.2;
                this.size = 35;
                this.baseValue = 100;
                this.currentMultiplier = 1;
                this.color = '#ff00ff'; // Neon Pink
            } else if (rand < 0.15) {
                this.type = 'boss'; // 10% BOSS
                this.maxHp = 25;
                this.speed = 0.8;
                this.size = 50;
                this.value = 300;
                this.color = '#ffd700'; // Emas
            } else {
                this.type = 'normal'; // Sisa: Normal
                this.maxHp = 2;
                this.speed = 2 + Math.random();
                this.size = 15 + Math.random() * 10;
                this.value = 10 + Math.floor(this.size);
                this.color = `hsl(${Math.random()*50 + 150}, 100%, 50%)`;
            }

            this.hp = this.maxHp;
        }

        update() {
            this.x += this.speed * this.direction;
            
            // Gerakan Sinus (Berenang)
            if (this.type !== 'bomb') {
                this.y += Math.sin(this.x * 0.02) * 2;
            }

            // Logika Khusus Multiplier
            if (this.type === 'multiplier') {
                // Nilai naik setiap frame (simulasi random count up)
                if (Math.random() < 0.05) this.currentMultiplier += 0.5;
            }

            // Respawn jika keluar layar
            if ((this.direction === 1 && this.x > width + 100) || (this.direction === -1 && this.x < -100)) {
                this.reset();
            }
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.scale(this.direction, 1);

            if (this.type === 'bomb') {
                // VISUAL BOM LAUT
                ctx.fillStyle = '#222';
                ctx.beginPath(); ctx.arc(0, 0, this.size, 0, Math.PI*2); ctx.fill();
                // Duri Bom
                for(let i=0; i<8; i++) {
                    ctx.rotate(Math.PI/4);
                    ctx.fillStyle = '#555';
                    ctx.beginPath(); ctx.moveTo(this.size, 0); ctx.lineTo(this.size+10, 5); ctx.lineTo(this.size+10, -5); ctx.fill();
                }
                // Ikon Tengkorak / Bahaya
                ctx.fillStyle = 'red';
                ctx.font = '20px Arial'; ctx.fillText("!", -3, 5);
                
                // Efek Berdenyut Merah
                if(Math.floor(Date.now()/200)%2===0) {
                    ctx.strokeStyle = 'red'; ctx.lineWidth = 3; ctx.beginPath(); ctx.arc(0,0,this.size-5,0,Math.PI*2); ctx.stroke();
                }

            } else if (this.type === 'multiplier') {
                // VISUAL MULTIPLIER (NEON)
                ctx.shadowBlur = 15; ctx.shadowColor = this.color;
                ctx.fillStyle = this.color;
                ctx.beginPath(); ctx.ellipse(0, 0, this.size, this.size/1.5, 0, 0, Math.PI*2); ctx.fill();
                
                // Text Count Up
                ctx.scale(this.direction, 1); // Balik text biar kebaca
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 16px Arial';
                ctx.fillText(`x${Math.floor(this.currentMultiplier)}`, -15, -this.size - 10);

            } else {
                // VISUAL BIASA / BOSS
                ctx.fillStyle = this.color;
                if(this.type === 'boss') { ctx.shadowBlur = 20; ctx.shadowColor = 'gold'; }
                
                ctx.beginPath(); ctx.ellipse(0, 0, this.size, this.size/2, 0, 0, Math.PI*2); ctx.fill();
                // Ekor
                ctx.beginPath(); ctx.moveTo(-this.size, 0); 
                ctx.lineTo(-this.size-20, -10 + Math.sin(Date.now()/100)*10);
                ctx.lineTo(-this.size-20, 10 + Math.sin(Date.now()/100)*10);
                ctx.fill();
            }
            ctx.restore();
        }
    }

    class Bullet {
        constructor(angle, isDrill) {
            this.x = width/2; this.y = height;
            this.angle = angle;
            this.isDrill = isDrill;
            this.speed = isDrill ? 15 : 10;
            this.active = true;
            this.vx = Math.cos(angle) * this.speed;
            this.vy = Math.sin(angle) * this.speed;
        }

        update() {
            this.x += this.vx; this.y += this.vy;
            if(this.x < 0 || this.x > width || this.y < 0 || this.y > height) this.active = false;
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.angle);

            if (this.isDrill) {
                // VISUAL DRILL (LASER)
                ctx.shadowBlur = 20; ctx.shadowColor = '#00d4ff';
                ctx.fillStyle = '#e0ffff';
                ctx.fillRect(-20, -5, 60, 10); // Badan drill
                ctx.beginPath(); ctx.moveTo(40, -5); ctx.lineTo(60, 0); ctx.lineTo(40, 5); ctx.fill(); // Ujung
            } else {
                // VISUAL PELURU BIASA
                ctx.fillStyle = '#ffcc00';
                ctx.beginPath(); ctx.arc(0, 0, 5, 0, Math.PI*2); ctx.fill();
            }
            ctx.restore();
        }
    }

    class Particle {
        constructor(x, y, type) {
            this.x = x; this.y = y; this.type = type;
            this.life = 1;
            this.vx = (Math.random()-0.5)*10;
            this.vy = (Math.random()-0.5)*10;
        }
        update() {
            this.x += this.vx; this.y += this.vy; this.life -= 0.03;
        }
        draw() {
            ctx.globalAlpha = this.life;
            if(this.type === 'coin') {
                ctx.fillStyle = 'gold'; ctx.beginPath(); ctx.arc(this.x, this.y, 5, 0, Math.PI*2); ctx.fill();
            } else if (this.type === 'explode') {
                ctx.fillStyle = 'orange'; ctx.beginPath(); ctx.arc(this.x, this.y, 10, 0, Math.PI*2); ctx.fill();
            }
            ctx.globalAlpha = 1;
        }
    }

    // --- GAMEPLAY FUNCTIONS ---

    function triggerExplosion(x, y) {
        // Efek Visual Shake
        body.classList.add('screen-shake');
        setTimeout(() => body.classList.remove('screen-shake'), 500);

        // AOE Damage Logic
        const explosionRadius = 250;
        
        // Visual Lingkaran Ledakan
        const gradient = ctx.createRadialGradient(x, y, 10, x, y, explosionRadius);
        gradient.addColorStop(0, 'white');
        gradient.addColorStop(0.5, 'orange');
        gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');
        
        // Kita simpan efek ledakan di array particles khusus jika mau (disini simplified logic)
        // Hitung Damage Area
        fishes.forEach(f => {
            const dist = Math.hypot(f.x - x, f.y - y);
            if (dist < explosionRadius) {
                f.hp = 0; // INSTANT KILL SEMUA IKAN DI AREA
                handleFishDeath(f, true);
            }
        });

        // Spawn Partikel Ledakan
        for(let i=0; i<30; i++) particles.push(new Particle(x, y, 'explode'));
    }

    function handleFishDeath(fish, chainReaction = false) {
        let winAmount = 0;

        if (fish.type === 'bomb') {
            triggerExplosion(fish.x, fish.y);
            showText("BOOM!", fish.x, fish.y, '#ff4444');
        } else if (fish.type === 'multiplier') {
            winAmount = Math.floor(fish.baseValue * fish.currentMultiplier);
            showText(`JACKPOT x${Math.floor(fish.currentMultiplier)}`, fish.x, fish.y, '#ff00ff');
            
            // Reward Tambahan: Aktifkan DRILL MODE
            if (!drillMode) {
                drillMode = true;
                drillTimer = 500; // Frames durasi
                document.getElementById('drill-status').style.display = 'block';
            }
        } else {
            winAmount = fish.value;
            if(!chainReaction) showText(`+${winAmount}`, fish.x, fish.y, 'gold');
        }

        balance += winAmount;
        
        // Efek Koin Jatuh
        for(let i=0; i<5; i++) particles.push(new Particle(fish.x, fish.y, 'coin'));
        
        fish.reset(); // Respawn ikan baru
        updateUI();
    }

    function showText(text, x, y, color) {
        const el = document.createElement('div');
        el.className = 'pop-msg';
        el.innerText = text;
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        el.style.color = color;
        body.appendChild(el);
        setTimeout(() => el.remove(), 800);
    }

    function shoot() {
        const cost = drillMode ? 0 : 10; // Drill gratis/bonus, normal bayar 10
        if (balance < cost) return;

        balance -= cost;
        updateUI();

        const angle = Math.atan2(MOUSE.y - height, MOUSE.x - width/2);
        bullets.push(new Bullet(angle, drillMode));
    }

    function updateUI() {
        document.getElementById('balance').innerText = balance.toLocaleString();
    }

    // --- MAIN LOOP ---

    // Init Fish
    for(let i=0; i<20; i++) fishes.push(new Fish());

    function loop() {
        // Clear Screen (Efek jejak)
        ctx.fillStyle = 'rgba(0, 5, 16, 0.4)';
        ctx.fillRect(0, 0, width, height);

        // Update Drill Timer
        if (drillMode) {
            drillTimer--;
            if (drillTimer <= 0) {
                drillMode = false;
                document.getElementById('drill-status').style.display = 'none';
            }
        }

        // Draw Fishes
        fishes.forEach(f => {
            f.update();
            f.draw();
        });

        // Update Bullets
        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i];
            b.update();
            b.draw();

            if (!b.active) { bullets.splice(i, 1); continue; }

            // Collision Check
            for (let f of fishes) {
                const dist = Math.hypot(b.x - f.x, b.y - f.y);
                if (dist < f.size + 10) { // Hitbox toleransi
                    f.hp -= (b.isDrill ? 5 : 1); // Drill damage besar
                    
                    // Efek Darah
                    particles.push(new Particle(b.x, b.y, 'blood'));

                    if (f.hp <= 0) {
                        handleFishDeath(f);
                    }

                    // Mekanik Drill: Peluru TIDAK hilang, tembus terus
                    if (!b.isDrill) {
                        b.active = false; 
                        break; 
                    }
                }
            }
        }

        // Particles
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.update();
            p.draw();
            if (p.life <= 0) particles.splice(i, 1);
        }

        // Draw Cannon Base
        ctx.fillStyle = drillMode ? '#00d4ff' : '#444';
        ctx.beginPath(); ctx.arc(width/2, height, 50, Math.PI, 0); ctx.fill();
        
        // Draw Cannon Barrel
        const angle = Math.atan2(MOUSE.y - height, MOUSE.x - width/2);
        ctx.save();
        ctx.translate(width/2, height);
        ctx.rotate(angle);
        ctx.fillStyle = drillMode ? '#e0ffff' : '#333';
        ctx.shadowBlur = drillMode ? 20 : 0; ctx.shadowColor = '#00d4ff';
        ctx.fillRect(0, -15, 70, 30);
        ctx.restore();

        requestAnimationFrame(loop);
    }

    canvas.addEventListener('mousedown', shoot);
    loop();

</script>
</body>
</html>
